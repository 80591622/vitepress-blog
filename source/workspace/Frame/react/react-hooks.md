

# Hooks
 
## Hookçš„è§„åˆ™
 
- åªåœ¨æœ€é¡¶å±‚ä½¿ç”¨ Hook
    - ä¸è¦åœ¨`å¾ªç¯`ï¼Œ`æ¡ä»¶`æˆ–`åµŒå¥—å‡½æ•°`ä¸­è°ƒç”¨ Hookï¼Œ ç¡®ä¿æ€»æ˜¯åœ¨ä½ çš„ React å‡½æ•°çš„æœ€é¡¶å±‚è°ƒç”¨ä»–ä»¬ã€‚éµå®ˆè¿™æ¡è§„åˆ™ï¼Œä½ å°±èƒ½ç¡®ä¿ Hook åœ¨æ¯ä¸€æ¬¡æ¸²æŸ“ä¸­éƒ½æŒ‰ç…§åŒæ ·çš„ <strong>`é¡ºåº`</strong> è¢«è°ƒç”¨ã€‚è¿™è®© React èƒ½å¤Ÿåœ¨å¤šæ¬¡çš„ useState å’Œ useEffect è°ƒç”¨ä¹‹é—´ä¿æŒ hook çŠ¶æ€çš„æ­£ç¡®ã€‚
- åªåœ¨ React å‡½æ•°ä¸­è°ƒç”¨ Hook     
    - åœ¨ React çš„å‡½æ•°ç»„ä»¶ä¸­è°ƒç”¨ Hook
    - åœ¨è‡ªå®šä¹‰ Hook ä¸­è°ƒç”¨å…¶ä»– Hook
       - **åœ¨ç±»ä¸­ä½¿ç”¨æŠ¥é”™è­¦å‘Š** ã€ŒHooks can only be called inside the body of a function componentã€
    

## ä½¿ç”¨Hooksçš„å¥½å¤„

**1.class å­¦ä¹ æˆæœ¬é«˜**<br/>
ç”Ÿå‘½å‘¨æœŸï¼ŒthisæŒ‡å‘å•¥çš„ï¼Œhooksåªè¦ä¼šusestate   useeffectå·®ä¸å¤šèƒ½è§£å†³æ‰€æœ‰é—®é¢˜<br/>
**2.classä¸šåŠ¡é€»è¾‘åˆ†æ•£**<br/>
å®šæ—¶å™¨ï¼Œdom2äº‹ä»¶å•¥çš„ä¸€å®šè¦åœ¨componentWillUnMount å»å¸è½½ã€‚è€Œæ˜¯ç”¨hookså°±éå¸¸èšåˆäº†ï¼Œç›´æ¥è¿”å›å‡½æ•°é‡Œé¢æ¸…æ¥šå°±å¯ä»¥äº†<br/>
**3.classé€»è¾‘å¤ç”¨å›°éš¾**<br/>
hooksæœ€æœ‰ä¼˜åŠ¿çš„å°±æ•°å¥¹çš„é€»è¾‘å¤ç”¨èƒ½åŠ›äº†<br/>
åœ¨classä¸­ä¸€èˆ¬ç”¨Render Propsï¼ˆå±€é™æ€§ï¼‰å’Œé«˜é˜¶ç»„ä»¶ï¼ˆåµŒå¥—å¤ªæ·±ï¼‰åšé€»è¾‘å¤ç”¨<br/>
æ¯”å¦‚ä¸€ä¸ªåˆ—è¡¨æ¸²æŸ“ï¼Œclassæ¯æ¬¡éƒ½è¦å†™æ•°æ®è¯·æ±‚ï¼Œä¸‹æ‹‰åŠ è½½ï¼Œä¸Šæ‹‰åˆ·æ–°é‡ç½®åˆ†é¡µï¼Œloadingå±•ç¤ºï¼Œè€Œåœ¨hooksé‡Œç›´æ¥è‡ªå®šä¹‰ä¸€ä¸ªhookså°±å¯ä»¥åšåˆ°å…¨éƒ¨çš„åˆ—è¡¨åŠ è½½é€»è¾‘å…¬ç”¨<br/>
**4.** class æ‰“åŒ…æ—¶æ— æ³•å¯¹ class çš„å±æ€§æ–¹æ³•è¿›è¡Œä¼˜åŒ–ï¼Œè€Œä½¿ç”¨ hooks åˆ™å¯ä»¥å°†ä»£ç å‹ç¼©åˆ°æè‡´ã€‚<br/>
**5.** æœ€ç›´æ¥çš„å°±æ˜¯ä¸šåŠ¡å˜æ›´çš„æ—¶å€™ä¸éœ€è¦å†æŠŠå‡½æ•°å¼ç»„ä»¶å˜æˆclassäº†


**ç¼ºç‚¹**<br/>
å½¢æˆå¤ªå¤šé—­åŒ…ï¼Œå®¹æ˜“å¯¼è‡´å†…å­˜æ³„æ¼<br/>
functionå†™å¤ªå¤šä»£ç åæœŸä¸å¥½ç»´æŠ¤

**è‡ªå®šä¹‰è¿‡çš„**<br/>
useFetch<br/>
useMouse<br/>
useScroll<br/>
useSize<br/>
useFrom<br/>
useTable<br/>
useStore<br/>


çœŸæ­£è¯´æœæˆ‘ä½¿ç”¨ react hooks çš„ï¼Œæ˜¯ react blog é‡Œé¢æåˆ°çš„ï¼Œä½¿ç”¨ class component æ‰“åŒ…æ—¶æ— æ³•å¯¹ class çš„å±æ€§æ–¹æ³•è¿›è¡Œä¼˜åŒ–ï¼Œè€Œ**ä½¿ç”¨ hooks åˆ™å¯ä»¥å°†ä»£ç å‹ç¼©åˆ°æè‡´**ã€‚<br/>
æœ‰äººä¼šè¯´ hooks æ˜¯è¶‹åŠ¿æ˜¯æœªæ¥å•¥çš„ï¼Œä½†æ˜¯ï¼Œå®é™…ä¸Šï¼Œhooks æ¯” class å¤æ‚å’Œéš¾ç†è§£å¤šäº†ï¼Œè€Œä¸”éšç€ä¸šåŠ¡é€»è¾‘çš„å¢é•¿ï¼Œä¸€ä¸ª function é‡Œé¢å°†ä¼šå†™å‡ºè¶Šæ¥è¶Šå¤šçš„ä»£ç ï¼Œ
è¶Šæ¥è¶Šå¤æ‚ï¼Œè®©ä½ æ— æ³•ç»´æŠ¤ã€‚è€Œå®é™…ä¸Šï¼Œåœ¨è¿è¡Œæ—¶ï¼Œä¸¤åˆ™çš„å·®åˆ«ä¸æ˜¯ç‰¹åˆ«å¤§ï¼Œéƒ½æ²¡æœ‰æ€§èƒ½ä¸Šçš„ä¼˜åŠ£ã€‚<br/>



    
## Hooksçš„æ–¹æ³•
 
| é’©å­å | ä½œç”¨ |
| --- | --- |
| `useState` | åˆå§‹åŒ–å’Œè®¾ç½®çŠ¶æ€ |
| `useEffect` | `componentDidMount`ã€`componentDidUpdate` å’Œ `componentWillUnmount` çš„ç»“åˆä½“ï¼Œå¯ç›‘å¬ `useState` å®šä¹‰å€¼çš„å˜åŒ– |
| `useContext` | å®šä¹‰ä¸€ä¸ªå…¨å±€çš„å¯¹è±¡ï¼Œç±»ä¼¼ `context` |
| `useReducer` | å¯ä»¥å¢å¼ºå‡½æ•°ï¼Œæä¾›ç±»ä¼¼ Redux çš„åŠŸèƒ½ |
| `useCallback` | å…·æœ‰è®°å¿†ä½œç”¨ï¼Œå…±æœ‰ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œå³æƒ³è¦åˆ›å»ºçš„å‡½æ•°ä½“ï¼›ç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œé‡Œé¢çš„æ¯ä¸€é¡¹æ˜¯ç”¨æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦é‡æ–°åˆ›å»ºå‡½æ•°ä½“çš„å˜é‡ã€‚å¦‚æœä¼ å…¥çš„å˜é‡å€¼ä¿æŒä¸å˜ï¼Œè¿”å›è®°å¿†ç»“æœï¼›å¦‚æœä»»ä½•ä¸€é¡¹æ”¹å˜ï¼Œåˆ™è¿”å›æ–°çš„ç»“æœ |
| `useMemo` | ä½œç”¨å’Œä¼ å…¥å‚æ•°ä¸ `useCallback` ä¸€è‡´ï¼Œä¸è¿‡ `useCallback` è¿”å›å‡½æ•°ï¼Œ`useMemo` è¿”å›å€¼ |
| `useRef` | è·å– `ref` å±æ€§å¯¹åº”çš„ DOM |
| `useImperativeMethods` | è‡ªå®šä¹‰ä½¿ç”¨ `ref` æ—¶å…¬å¼€ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼ |
| `useLayoutEffect` | ä½œç”¨ä¸ `useEffect` ç›¸åŒï¼Œä½†åœ¨æ‰€æœ‰ DOM æ”¹å˜ååŒæ­¥è§¦å‘ |
| `useDebugValue` | å¯ç”¨äºåœ¨ React å¼€å‘è€…å·¥å…·ä¸­æ˜¾ç¤ºè‡ªå®šä¹‰ hook çš„æ ‡ç­¾ |
 
 
## useState


```javascript{2}
//ç›´æ¥ä¼ å…¥åˆå§‹å€¼
const [state, setState] = useState(initialState);

//ä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨å‡½æ•°ä¸­è®¡ç®—å¹¶è¿”å›åˆå§‹çš„ stateï¼Œæ­¤å‡½æ•°åªåœ¨åˆå§‹æ¸²æŸ“æ—¶è¢«è°ƒç”¨
const [state, setState] = useState(() => {
  const initialState = ff(props); 
  return initialState;
});
```

å®˜æ–¹å»ºè®®æ¨èæŠŠ state åˆ‡åˆ†æˆå¤šä¸ª state å˜é‡ï¼Œæ¯ä¸ªå˜é‡åŒ…å«çš„ä¸åŒå€¼ä¼šåœ¨åŒæ—¶å‘ç”Ÿå˜åŒ–ã€‚

**å¥½å¤„æ˜¯**

- åæœŸæŠŠä¸€äº›ç›¸å…³çš„é€»è¾‘æŠ½å–åˆ°ä¸€ä¸ªè‡ªå®šä¹‰ Hook å˜å¾—å®¹æ˜“<br/>
- èµ‹å€¼çš„æ—¶å€™ç®€å•ï¼Œå¤šä¸ªéœ€è¦å…‹éš†ä¸‹ï¼ŒæŠŠä¸å˜çš„å­˜å‚¨ä¸‹æ¥

```javascript
setState(state+1);  //ç›´æ¥ä»åˆå§‹å€¼é‡Œé¢è·å–
setState(prevState=>prevState+1) //è¯¥å‡½æ•°å°†æ¥æ”¶å…ˆå‰çš„state,å¹¶è¿”å›ä¸€ä¸ªæ›´æ–°åçš„å€¼
```

## useEffect
| ä¾èµ–é¡¹ | å‰¯ä½œç”¨æ‰§è¡Œæ—¶æœº |
| --- | --- |
| æ²¡æœ‰ä¾èµ–é¡¹ | ç»„ä»¶åˆå§‹æ¸²æŸ“ + ç»„ä»¶æ›´æ–°æ—¶æ‰§è¡Œ |
| ç©ºæ•°ç»„ä¾èµ–é¡¹ | åªåœ¨åˆå§‹æ¸²æŸ“æ—¶æ‰§è¡Œä¸€æ¬¡ |
| æ·»åŠ ç‰¹å®šä¾èµ–é¡¹ | ç»„ä»¶åˆå§‹æ¸²æŸ“ + ç‰¹å®šä¾èµ–é¡¹å˜åŒ–æ—¶æ‰§è¡Œ |
 
`componentDidMount`, `componentDidUpdate`, `componentWillUnmount`ï¼šuseEffect Hook å¯ä»¥è¡¨è¾¾æ‰€æœ‰è¿™äº›(åŒ…æ‹¬ ä¸é‚£ä¹ˆ å¸¸è§ çš„åœºæ™¯)çš„ç»„åˆã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œeffect å°†åœ¨æ¯è½®`æ¸²æŸ“ç»“æŸåæ‰§è¡Œ`ï¼Œä½†ä½ å¯ä»¥é€‰æ‹©è®©å®ƒ åœ¨åªæœ‰`æŸäº›å€¼æ”¹å˜`çš„æ—¶å€™ æ‰æ‰§è¡Œã€‚


```javascript{8}
function Counter() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    const timer = setInterval(() => {
      setCount(c => c + 1); 
    }, 1000);
    return () => clearInterval(timer);
  }, []); 
  return <h1>{count}</h1>;
}
```
ä¸ºé˜²æ­¢å†…å­˜æ³„æ¼ï¼Œæ¸…é™¤å‡½æ•°ä¼šåœ¨ç»„ä»¶å¸è½½å‰æ‰§è¡Œã€‚å¦å¤–ï¼Œå¦‚æœç»„ä»¶å¤šæ¬¡æ¸²æŸ“ï¼ˆé€šå¸¸å¦‚æ­¤ï¼‰ï¼Œåˆ™åœ¨æ‰§è¡Œä¸‹ä¸€ä¸ª effect ä¹‹å‰ï¼Œ`ä¸Šä¸€ä¸ª effect å°±å·²è¢«æ¸…é™¤`ã€‚çœ‹ä¸‹ä¸ªæ —å­ï¼š

```javascript{5,6,7,8,9,10,15,16,17,18}
import React, {Fragment, useState, useEffect, useRef} from "react";

const Example = () => {
    const [count, setCount] = useState(1);
    useEffect(() => {
        console.log("11");
        return () => {
            console.log("22")
        }
    });
    return (
        <Fragment>
            {console.log("æ¸²æŸ“")}
            <h1>{count}</h1>
            <button onClick={() => {
                setCount(count + 1)
            }}> +
            </button>
        </Fragment>
    );
};
export default Example
```

![](https://ae01.alicdn.com/kf/H66bfd87154314ad49baee2dd855336acT.gif)

æ‰“å°çš„é¡ºåºä¸º **æ¸²æŸ“->22->11**

è‹¥å¤šæ¬¡æ‰§è¡Œeffectï¼Œå…¶å†…éƒ¨ä¼šç”Ÿæˆæ–°çš„å‡½æ•°ï¼Œï¼ˆeffectè¿˜æ˜¯åŸå‡½æ•°ï¼Œæˆ–è€…è¯´æŒ‡å‘åŸåœ°å€ï¼‰è¿™æ ·çš„è¯å¦‚æœæˆ‘æ˜¯å®šä¹‰çš„äº‹ä»¶ï¼Œæ¯æ¬¡æ›´æ–°éƒ½ä¼šæ‰§è¡Œï¼Œé‚£ä¹ˆå²‚ä¸æ˜¯åœ¨äº‹ä»¶è¿˜æ²¡æœ‰ç§»é™¤æ‰åˆå®šä¹‰äº†ä¸€æ¬¡ï¼Œæ‰€ä»¥useEffectåŠ å…¥äº†è¿™ä¸ªåŠŸèƒ½ã€‚

```javascript{6,7,8,9,10,11,12,13,14,15}
import React, {useState, useEffect} from "react";

const Example = () => {
    const [width, setWidth] = useState(window.innerWidth);
    const [count, setCount] = useState(1);
    const resizeHandle = () => {
        setWidth(window.innerWidth);
        console.log(window.innerWidth);
    };
    const a = useEffect(() => {
        window.addEventListener("resize", resizeHandle);
        return () => {
            // window.removeEventListener("resize", resizeHandle)
        }
    });  //æˆ–è€…ä½¿ç”¨[]

    return (
        <Fragment>
            <h1>{width}</h1>
            <button onClick={() => {
                setCount(count + 1)
            }}>+
            </button>
        </Fragment>
    );
}
export default Example
```

çœ‹ä¸‹é¢å›¾ç‰‡å¯ä»¥çœ‹å‡ºæ¥ï¼Œé‡å¤å¤šæ¬¡æ‰§è¡Œäº†`resize`æ–¹æ³•

![](https://ae01.alicdn.com/kf/H9d109cbe0722447baf4ef132fa24268fE.gif)


[å®˜æ–¹å»ºè®®effectä½¿ç”¨çš„æ–¹æ³•å£°æ˜åœ¨å…¶å†…éƒ¨](http://file.wkdevhub.cn/workspace/Frame/react/use-hooks.html#useeffect%E5%9C%A8%E5%A4%96%E9%9D%A2%E5%A3%B0%E6%98%8E%E5%87%BD%E6%95%B0')

## useContext
 
React16ä¸­æ›´æ–°äº†Context APIï¼ŒContextä¸»è¦ç”¨äºçˆ·å­™ç»„ä»¶çš„ä¼ å€¼é—®é¢˜ï¼Œæ–°çš„Context APIä½¿ç”¨è®¢é˜…å‘å¸ƒè€…æ¨¡å¼æ–¹å¼å®ç°åœ¨çˆ·å­™ç»„ä»¶ä¸­ä¼ å€¼
 
React Hookså‡ºç°ä¹‹åä¹Ÿå¯¹Context APIå‡ºäº†å“åº”çš„Hook useContextã€‚åŒæ ·ä¹Ÿæ˜¯è§£ä¼ å€¼çš„é—®é¢˜

```javascript{11}
const stateContext = createContext('default');

//çˆ¶ç»„ä»¶
<stateContext.Provider
    value={"Hello React"}
>
    <ContextComponent/>
</stateContext.Provider>
//å­ç»„ä»¶ 
const ContextComponent = () => {
    const value = useContext(stateContext);
    return (
        <>
            <h1>{value}</h1>
        </>
    );
}
```

å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨`useContextä»ç„¶éœ€è¦åœ¨ä¸Šå±‚ç»„ä»¶ä¸­ä½¿ç”¨<MyContext.Provider>`æ¥ä¸ºä¸‹å±‚ç»„ä»¶æä¾›contextã€‚

## useReducer

<img src='/img/redux.jpeg'/>

ä¸ºäº†èŒè´£æ¸…æ™°ï¼Œæ•°æ®æµå‘æ˜ç¡®ï¼ŒRedux æŠŠæ•´ä¸ªæ•°æ®ä¿®æ”¹çš„æµç¨‹åˆ†æˆäº†ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š
1. stateï¼šä¸€ä¸ªå¯¹è±¡ï¼Œå­˜æ”¾ç€æˆ‘ä»¬ç®¡ç†çš„æ•°æ®çŠ¶æ€ã€‚
2. actionï¼šä¸€ä¸ªå¯¹è±¡ï¼Œç”¨æ¥æè¿°ä½ æƒ³æ€ä¹ˆæ”¹æ•°æ®ã€‚
3. reducerï¼šä¸€ä¸ªå‡½æ•°ï¼Œæ ¹æ® action çš„æè¿°ç”Ÿæˆä¸€ä¸ªæ–°çš„ state ã€‚


çœ‹åˆ°`useReducer`,è‚¯å®šä¼šæƒ³åˆ°Reduxï¼Œæ²¡é”™å®ƒå’ŒReduxçš„å·¥ä½œæ–¹å¼æ˜¯ä¸€æ ·çš„ã€‚useReducerçš„å‡ºç°æ˜¯useStateçš„æ›¿ä»£æ–¹æ¡ˆï¼Œèƒ½å¤Ÿè®©æˆ‘ä»¬æ›´å¥½çš„ç®¡ç†çŠ¶æ€ã€‚

```javascript
const [state, dispatch] = useReducer(reducer, initialArg, init);
```

åœ¨æŸäº›åœºæ™¯ä¸‹ï¼ŒuseReducer ä¼šæ¯” useState æ›´é€‚ç”¨ï¼Œä¾‹å¦‚ state `é€»è¾‘è¾ƒå¤æ‚ä¸”åŒ…å«å¤šä¸ªå­å€¼ï¼Œæˆ–è€…ä¸‹ä¸€ä¸ª state ä¾èµ–äºä¹‹å‰çš„ state `ç­‰ã€‚
å¹¶ä¸”ï¼Œä½¿ç”¨ useReducer è¿˜èƒ½ç»™é‚£äº›ä¼šè§¦å‘æ·±æ›´æ–°çš„ç»„ä»¶åšæ€§èƒ½ä¼˜åŒ–ï¼Œ`å› ä¸ºä½ å¯ä»¥å‘å­ç»„ä»¶ä¼ é€’ dispatch è€Œä¸æ˜¯å›è°ƒå‡½æ•°` ã€‚

```javascript{3,4,5,6,7,8,9,10,11,12,19,20}
const initialState = {count: 0};

function reducer(state, action) {
  switch (action.type) {
    case 'increment':
      return {count: state.count + 1};
    case 'decrement':
      return {count: state.count - 1};
    default:
      throw new Error();
  }
}

function Counter() {
  const [state, dispatch] = useReducer(reducer, initialState);
  return (
    <>
      Count: {state.count}
      <button onClick={() => dispatch({type: 'decrement'})}>-</button>
      <button onClick={() => dispatch({type: 'increment'})}>+</button>
    </>
  );
}
```

**ç¬¬ä¸‰ä¸ªå‚æ•°(æƒ°æ€§åˆå§‹åŒ–)**

useReducerçš„ç¬¬ä¸‰ä¸ªå‚æ•°æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶æŠŠç¬¬äºŒä¸ªå‚æ•°å½“ä½œå‡½æ•°çš„å‚æ•°æ‰§è¡Œã€‚ä¸»è¦ä½œç”¨æ˜¯åˆå§‹å€¼çš„æƒ°æ€§æ±‚å€¼ï¼ŒæŠŠä¸€äº›å¯¹çŠ¶æ€çš„é€»è¾‘æŠ½ç¦»å‡ºæ¥ï¼Œæœ‰åˆ©äºé‡ç½®stateã€‚

```javascript{2,3,4,5,6,13,14,26}
import React, {Fragment, useState, useEffect, useRef, useCallback, useMemo, useReducer} from "react";
const initialState = {count: 0};
function init(s) {
    console.log(s);
    return {...s};
}
function reducer(state, action) {
    switch (action.type) {
        case 'increment':
            return {count: state.count + 1};
        case 'decrement':
            return {count: state.count - 1};
        case 'reset':
            return init(action.payload);
        default:
            throw new Error();
    }
}
function Counter() {
    const [state, dispatch] = useReducer(reducer, initialState, init);
    return (
        <Fragment>
            Count: {state.count}
            <button onClick={() => dispatch({type: 'decrement'})}>-</button>
            <button onClick={() => dispatch({type: 'increment'})}>+</button>
            <button onClick={() => dispatch({type: 'reset', payload: initialState})}>é‡ç½®</button>
        </Fragment>
    );
}
export default Counter

```

## useCallback
ç”¨äºç¼“å­˜å‡½æ•°ï¼Œé¿å…åœ¨æ¯æ¬¡ç»„ä»¶æ¸²æŸ“æ—¶éƒ½é‡æ–°åˆ›å»ºå‡½æ•°ï¼Œä»è€Œä¼˜åŒ–æ€§èƒ½  
- ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯éœ€è¦ memoize çš„å›è°ƒå‡½æ•°ã€‚  
- ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«äº†æ‰€æœ‰è¯¥å›è°ƒå‡½æ•°ä¾èµ–çš„å€¼ã€‚åªæœ‰å½“æ•°ç»„ä¸­çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒuseCallback æ‰ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°  

```jsx
const memoizedCallback = useCallback(
  () => {
    doSomething(a, b);
  },
  [a, b],
);



```

```jsx
import React, { useState, useCallback } from 'react';

// ä½¿ç”¨ React.memo åŒ…è£¹å­ç»„ä»¶
const ChildComponent = React.memo(({ onClick }) => {
    return <button onClick={onClick}>Click me</button>;
});

const ParentComponent = () => {
    const [count, setCount] = useState(0);

    // ä½¿ç”¨ useCallback ç¼“å­˜å‡½æ•°
    const handleClick = useCallback(() => {
        setCount(count + 1);
    }, [count]);

    return (
        <div>
            <p>Count: {count}</p>
            <ChildComponent onClick={handleClick} />
        </div>
    );
};

export default ParentComponent;
```


## useMemo

- `ç¬¬ä¸€ä¸ªå‚æ•°`ï¼šæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°åŒ…å«éœ€è¦è¿›è¡Œçš„è®¡ç®—é€»è¾‘ï¼Œå¹¶ä¸”è¿”å›è®¡ç®—ç»“æœ    
-  `ç¬¬äºŒä¸ªå‚æ•°`ï¼šæ˜¯ä¸€ä¸ªä¾èµ–é¡¹æ•°ç»„ï¼Œå½“æ•°ç»„ä¸­çš„æŸä¸ªå€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒuseMemo ä¼šé‡æ–°è°ƒç”¨ç¬¬ä¸€ä¸ªå‚æ•°ä¸­çš„å‡½æ•°è¿›è¡Œè®¡ç®—ï¼›å¦‚æœä¾èµ–é¡¹æ•°ç»„ä¸ºç©ºï¼Œåˆ™ useMemo åªä¼šåœ¨ç»„ä»¶æŒ‚è½½æ—¶è®¡ç®—ä¸€æ¬¡  

```jsx
import React, { useState, useMemo } from 'react';

const numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];

const Example = () => {
    const [filterValue, setFilterValue] = useState(5);

    // ä½¿ç”¨ useMemo è¿›è¡Œè¿‡æ»¤æ“ä½œ
    const filteredNumbers = useMemo(() => {
        return numbers.filter(num => num > filterValue);
    }, [filterValue]);

    return (
        <div>
            <input
                type="number"
                value={filterValue}
                onChange={(e) => setFilterValue(Number(e.target.value))}
                placeholder="Enter filter value"
            />
            <ul>
                {filteredNumbers.map(num => (
                    <li key={num}>{num}</li>
                ))}
            </ul>
        </div>
    );
};

export default Example;
```

## useRef

æœ¬è´¨ä¸Š`useRef`å°±åƒæ˜¯å¯ä»¥åœ¨å…¶`.current`å±æ€§ä¸­ä¿å­˜ä¸€ä¸ªå¯å˜å€¼çš„â€œç›’å­â€ï¼Œ`useRef(null)è¿”å›å€¼`æ˜¯ä¸å¯æ‹“å±•çš„å±æ€§,`.current`å¯ä»¥ã€‚

ä¸‹ç¯‡ä»‹ç»å¦‚ä½•ä½¿ç”¨è€ŒuseRefè‡ªå·±æœ€æ–°çš„å€¼ï¼Œæˆ–è€…å­˜å‚¨ä¸Šä¸€æ¬¡propsæˆ–è€…stateçš„å€¼ï¼›æˆ‘ä»¬ç›´æ¥å£°æ˜ä¸€ä¸ªå€¼å­˜å‚¨å½“å‰çš„å€¼ä¸å¥½å—ï¼Œä¸ºå•¥è¦å€ŸåŠ©useRef()

**è¿™æ˜¯å› ä¸ºå®ƒåˆ›å»ºçš„æ˜¯ä¸€ä¸ªæ™®é€šJavascriptå¯¹è±¡ã€‚è€ŒuseRef()å’Œè‡ªå»ºä¸€ä¸ª {current: ...}å¯¹è±¡çš„å”¯ä¸€åŒºåˆ«æ˜¯ï¼ŒuseRefä¼šåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶è¿”å›åŒä¸€ä¸ªrefå¯¹è±¡ã€‚**

```javascript{4,9}
import React, {Fragment, useState, useEffect, useRef, useCallback, useMemo, useReducer} from "react";

const Example = () => {
    let inputRef = useRef(null);
    useEffect(() => {
        inputRef.current.focus();
    }, []);
    return (
        <input type="text" ref={inputRef}/>
    )
};

export default Example
```


## useImperativeHandle

```javascript
useImperativeHandle(ref, createHandle, [deps])
```

`useImperativeHandle`å¯ä»¥è®©ä½ åœ¨ä½¿ç”¨ ref æ—¶`è‡ªå®šä¹‰`æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåº”å½“é¿å…ä½¿ç”¨ ref è¿™æ ·çš„å‘½ä»¤å¼ä»£ç ã€‚`useImperativeHandle` åº”å½“ä¸ `forwardRef` ä¸€èµ·ä½¿ç”¨

å°±æ˜¯è¯´ï¼šå½“æˆ‘ä»¬ä½¿ç”¨çˆ¶ç»„ä»¶æŠŠrefä¼ é€’ç»™å­ç»„ä»¶çš„æ—¶å€™ï¼Œè¿™ä¸ªHookså…è®¸åœ¨å­ç»„ä»¶ä¸­æŠŠè‡ªå®šä¹‰å®ä¾‹é™„åŠ åˆ°çˆ¶ç»„ä»¶ä¼ è¿‡æ¥çš„refä¸Šï¼Œæœ‰åˆ©äºçˆ¶ç»„ä»¶æ§åˆ¶å­ç»„ä»¶ã€‚


```javascript{11,12,14,13,15,16,17,18,19,20,24,30,31,35}
import React, {
    Fragment,
    useRef,
    useImperativeHandle,
    forwardRef,
    useEffect
} from "react";

function FancyInput(props, ref) {
    const inputRef = useRef();
    useImperativeHandle(ref, () => (
        {
            addText: () => {
                inputRef.current.value = "æˆ‘æ˜¯ç”±çˆ¶çº§æ·»åŠ çš„";
            },
            focus: () => {
                inputRef.current.focus();
            }
        }
    ));
    return <input ref={inputRef}/>;
}

const TempFancyInput = forwardRef(FancyInput);

const Example = () => {
    let ref = useRef(null);
    useEffect(() => {
        console.log(ref);
        ref.current.addText();
        ref.current.focus();
    });
    return (
        <Fragment>
            <TempFancyInput ref={ref}/>
        </Fragment>
    )
};
export default Example
```
![](https://ae01.alicdn.com/kf/H3eab0df2695d4654a1f9e9a9b1f20edem.png)

## useLayoutEffect

è¿™ä¸ªé’©å­å‡½æ•°ä¸useEffectç›¸åŒï¼Œä½†å®ƒä¼šåœ¨æ‰€æœ‰çš„DOMå˜æ›´ä¹‹å`åŒæ­¥`è°ƒç”¨effectã€‚å¯ä»¥ä½¿ç”¨å®ƒæ¥è¯»å–DOMå¸ƒå±€å¹¶åŒæ­¥è§¦å‘é‡æ¸²æŸ“ã€‚åœ¨æµè§ˆå™¨æ‰§è¡Œç»˜åˆ¶ä¹‹å‰ï¼ŒuseLayoutEffect å†…éƒ¨çš„æ›´æ–°è®¡åˆ’å°†è¢«åŒæ­¥åˆ·æ–°ã€‚

å®˜ç½‘å»ºè®®è¿˜æ˜¯å°½å¯èƒ½çš„æ˜¯ä½¿ç”¨æ ‡å‡†çš„useEffecä»¥é¿å…é˜»å¡è§†è§‰æ›´æ–°ã€‚

## useDebugValue

useDebugValue å¯ç”¨äºåœ¨ React å¼€å‘è€…å·¥å…·ä¸­æ˜¾ç¤ºè‡ªå®šä¹‰ hook çš„æ ‡ç­¾ã€‚

## è‡ªå®šä¹‰ Hook å¿…é¡»ä»¥ use å¼€å¤´å—ï¼Ÿ
 
å¿…é¡»å¦‚æ­¤ã€‚è¿™ä¸ªçº¦å®šéå¸¸é‡è¦ã€‚ä¸éµå¾ªçš„è¯ï¼Œç”±äºæ— æ³•åˆ¤æ–­æŸä¸ªå‡½æ•°æ˜¯å¦åŒ…å«å¯¹å…¶å†…éƒ¨ Hook çš„è°ƒç”¨ï¼ŒReact å°†æ— æ³•è‡ªåŠ¨æ£€æŸ¥ä½ çš„ Hook æ˜¯å¦è¿åäº† Hook çš„[è§„åˆ™](https://react.docschina.org/docs/hooks-rules.html)ã€‚
 
```javascript
const useWinResize = () => {
 const [size, setSize] = useState({
     width: document.documentElement.clientWidth,
     height: document.documentElement.clientHeight
 });
 const resize = useCallback(() => {
     setSize({
     width: document.documentElement.clientWidth,
     height: document.documentElement.clientHeight
 })
 }, [])
 useEffect(() => {
     window.addEventListener('resize', resize);
     return () => window.removeEventListener('resize', resize);
 }, []);
 return size;
}

//ä½¿ç”¨
const Home = () => {
 const {width, height} = useWinResize();

 return <div>
         <p>width: {width}</p>
         <p>height: {height}</p>
  </div>;
};
```


## é¢è¯•é¢˜ç¤ºä¾‹

```javascript
import React, {Fragment, useState, useEffect, useRef, useCallback} from "react";
const useInterval = (callback, delay) => {
    useEffect(() => {
        if (delay !== null) {
            let id = setInterval(callback, delay);
            return () => clearInterval(id);
        }
    }, [delay]);
};
function Home() {
    const [count, setCount] = useState(0);
    const [diff, setDiff] = useState(500);
    useInterval(() => {
        setCount(count + 1);
    }, diff);
    return (
        <Fragment>
            <p> count: {count} </p>
            <p> diff: {diff}ms </p>
            <p>
                <button onClick={() => setDiff(diff - 50)}> åŠ å¿«50ms</button>
                <button onClick={() => setDiff(diff + 50)}> å‡æ…¢50ms</button>
            </p>
        </Fragment>
    );
}
export default Home
```

å¯æ˜¯è¿™æ®µè¿è¡Œåå¾ˆå¥‡æ€ªï¼Œé¡µé¢ä»0åˆ°1åï¼Œå°±å†ä¹Ÿä¸å˜äº†ï¼Œconsole.log(count)çš„è¾“å‡ºè¡¨æ˜ä»£ç å¹¶æ²¡æœ‰å¡æ­»ï¼Œé‚£ä¹ˆé—®é¢˜å‡ºåœ¨å“ªå„¿äº†ï¼Ÿ<br/>
Reactç»„ä»¶ä¸­çš„propså’Œstateæ˜¯å¯ä»¥æ”¹å˜çš„ï¼ŒReactä¼šé‡æ¸²æŸ“å®ƒä»¬ä¸”ã€Œä¸¢å¼ƒã€ä»»ä½•å…³äºä¸Šä¸€æ¬¡æ¸²æŸ“çš„ç»“æœï¼Œå®ƒä»¬ä¹‹é—´ä¸å†æœ‰ç›¸å…³æ€§ã€‚<br/>
useEffect()Hookä¹Ÿã€Œä¸¢å¼ƒã€ä¸Šä¸€æ¬¡æ¸²æŸ“ç»“æœï¼Œå®ƒä¼šæ¸…é™¤ä¸Šä¸€æ¬¡effectå†å»ºç«‹ä¸‹ä¸€ä¸ªeffectï¼Œä¸‹ä¸€ä¸ªeffect`é”ä½æ–°çš„propså’Œstate`ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡å°è¯•ç®€å•ç¤ºä¾‹å¯ä»¥æ­£ç¡®å·¥ä½œçš„åŸå› ã€‚<br/>
ä½†setIntervalä¸ä¼šã€Œä¸¢å¼ƒã€ã€‚å®ƒä¼šä¸€ç›´å¼•ç”¨è€çš„propså’Œstateç›´åˆ°ä½ æŠŠå®ƒæ¢æ‰â€”â€”ä¸é‡ç½®æ—¶é—´ä½ æ˜¯æ— æ³•åšåˆ°çš„ã€‚è¿™é‡Œå°±è¦ç”¨åˆ°useRefè¿™ä¸ªhookäº†ï¼Œæˆ‘ä»¬æŠŠcallbackå­˜å‚¨åˆ°refä¸­ï¼Œå½“callbackæ›´æ–°æ—¶å»æ›´æ–°ref.currentçš„å€¼ï¼š

ä¸¤ç§æ–¹æ³•:ã€ä¸€ç§æ˜¯æŠŠcountå­˜èµ·æ¥ï¼Œä¸€ç§æ˜¯æŠŠå®šæ—¶å™¨é‡Œé¢çš„å‡½æ•°å­˜èµ·æ¥ã€‘

```javascript
import React, {Fragment, useState, useEffect, useRef, useCallback} from "react";
const useInterval = (callback, delay, val) => {
    const saveCallback = useRef();
    useEffect(() => {
        saveCallback.current = val
    },[val]);
    useEffect(() => {
        if (delay !== null) {
            let id = setInterval(() => callback(saveCallback.current), delay);
            return () => clearInterval(id);
        }
    }, [delay]);
};
function Home() {
    const [count, setCount] = useState(0);
    const [diff, setDiff] = useState(500);
    useInterval((val) => {
        setCount(val + 1);
    }, diff, count);
    return (
        <Fragment>
            <p> count: {count} </p>
            <p> diff: {diff}ms </p>
            <p>
                <button onClick={() => setDiff(diff - 50)}> åŠ å¿«50ms</button>
                <button onClick={() => setDiff(diff + 50)}> å‡æ…¢50ms</button>
            </p>
        </Fragment>
    );
}
// const useInterval = (callback, delay) => {
//     const saveCallback = useRef();
//
//     useEffect(() => {
//         // æ¯æ¬¡æ¸²æŸ“åï¼Œä¿å­˜æ–°çš„å›è°ƒåˆ°æˆ‘ä»¬çš„ ref é‡Œ
//         saveCallback.current = callback;
//     });
//
//     useEffect(() => {
//         function tick() {
//             saveCallback.current();  //æ¯æ¬¡æ‰§è¡Œæœ€æ–°çš„callback
//         }
//
//         if (delay !== null) {
//             let id = setInterval(tick, delay);
//             return () => clearInterval(id);
//         }
//     }, [delay]);
// };

export default Home

```

## `Hooks FAQ`

### useEffectåœ¨å¤–é¢å£°æ˜å‡½æ•°

**ä¸€èˆ¬æ¥è¯´ï¼Œä¸å®‰å…¨**

```javascript
function Example({ someProp }) {
  function doSomething() {
    console.log(someProp);
  }

  useEffect(() => {
    doSomething();
  }, []); // ğŸ”´ è¿™æ ·ä¸å®‰å…¨ï¼ˆå®ƒè°ƒç”¨çš„ `doSomething` å‡½æ•°ä½¿ç”¨äº† `someProp`ï¼‰
}
```
è¦è®°ä½ effect å¤–éƒ¨çš„å‡½æ•°ä½¿ç”¨äº†å“ªäº› props å’Œ state å¾ˆéš¾ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ é€šå¸¸ä½ ä¼šæƒ³è¦åœ¨ effect å†…éƒ¨ å»å£°æ˜å®ƒæ‰€éœ€è¦çš„å‡½æ•°ã€‚ è¿™æ ·å°±èƒ½å®¹æ˜“çš„çœ‹å‡ºé‚£ä¸ª effect ä¾èµ–äº†ç»„ä»¶ä½œç”¨åŸŸä¸­çš„å“ªäº›å€¼ï¼š

```javascript
function Example({ someProp }) {
  useEffect(() => {
    function doSomething() {
      console.log(someProp);
    }

    doSomething();
  }, [someProp]); // âœ… å®‰å…¨ï¼ˆæˆ‘ä»¬çš„ effect ä»…ç”¨åˆ°äº† `someProp`ï¼‰
}
```

**å¦‚æœå¤„äºæŸäº›åŸå› ä½ æ— æ³•æŠŠä¸€ä¸ªå‡½æ•°ç§»åŠ¨åˆ°effectå†…éƒ¨ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–åŠæ³•ï¼š**

- ä½ å¯ä»¥å°è¯•æŠŠé‚£ä¸ªå‡½æ•°ç§»åŠ¨åˆ°ä½ çš„ç»„ä»¶ä¹‹å¤–ã€‚é‚£æ ·ä¸€æ¥ï¼Œè¿™ä¸ªå‡½æ•°å°±è‚¯å®šä¸ä¼šä¾èµ–ä»»ä½• props,æˆ–stateå¹¶ä¸”ä¹Ÿä¸ç”¨å‡ºç°åœ¨ä¾èµ–åˆ—è¡¨ä¸­äº†ã€‚

- å¦‚æœä½ æ‰€è°ƒç”¨çš„æ–¹æ³•æ˜¯ä¸€ä¸ªçº¯è®¡ç®—ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ¸²æŸ“æ—¶è°ƒç”¨ï¼Œä½ å¯ä»¥ è½¬è€Œåœ¨ effect ä¹‹å¤–è°ƒç”¨å®ƒï¼Œ å¹¶è®© effect ä¾èµ–äºå®ƒçš„è¿”å›å€¼ã€‚

- ä¸‡ä¸å¾—å·²çš„æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥æŠŠå‡½æ•°åŠ å…¥effectçš„ä¾èµ–ä½† æŠŠå®ƒçš„å®šä¹‰åŒ…è£¹ è¿›`useCallback Hook`ã€‚è¿™å°±ç¡®ä¿äº†å®ƒä¸éšæ¸²æŸ“è€Œæ”¹å˜ï¼Œé™¤é å®ƒè‡ªèº« çš„ä¾èµ–å‘ç”Ÿäº†æ”¹å˜

## å¦‚ä½•è·å–ä¸Šä¸€è½®çš„ props æˆ– state

```javascript
import React, {Fragment, useState, useEffect, useRef} from "react";

function usePrevious(value) {
    const ref = useRef();
    useEffect(() => {
        ref.current = value;
    });
    console.log(1)
    return ref.current;
}

function Example() {
    const [count, setCount] = useState(0);
    const prevCount = usePrevious(count);
    //æ­¤æ—¶prevCountæ˜¯ä¸Šä¸€æ¬¡çš„effectçš„è°ƒç”¨ï¼Œå†…éƒ¨å·²ç»æ”¹å˜,åªæ˜¯æ²¡æœ‰é‡æ–°æ¸²æŸ“
    console.log(2)  //å…ˆæ¸²æŸ“åæ‰§è¡Œè¿™ä¸ªeffect
    return <>
        <h1>Now: {count}, before: {prevCount}</h1>
        <div onClick={() => setCount((val) => val + 1)}>
            ç‚¹å‡»åŠ ä¸€
        </div>
    </>
}

export default Example
```

![](https://ae01.alicdn.com/kf/Hd6588fe44428462c90a0d7ee879c5948a.gif)

è€ƒè™‘åˆ°è¿™æ˜¯ä¸€ä¸ªç›¸å¯¹å¸¸è§çš„ä½¿ç”¨åœºæ™¯ï¼Œå¾ˆå¯èƒ½åœ¨æœªæ¥ React ä¼šè‡ªå¸¦ä¸€ä¸ª usePrevious Hookã€‚

## ä¸ºä»€ä¹ˆæˆ‘ä¿®æ”¹ååœ¨åˆ«çš„å‡½æ•°ä¸­è·å–çš„è¿˜æ˜¯ä¸Šä¸€æ¬¡çš„å€¼

ç»„ä»¶å†…éƒ¨çš„ä»»ä½•å‡½æ•°ï¼ŒåŒ…æ‹¬äº‹ä»¶å¤„ç†å‡½æ•°å’Œ effectï¼Œéƒ½æ˜¯ä»å®ƒ`è¢«åˆ›å»º`çš„é‚£æ¬¡æ¸²æŸ“ä¸­æ‹¿åˆ°çš„

```javascript{10}
import React, {useState, useRef} from "react";
function Example() {
    const [count, setCount] = useState(0);
    function handleClick() {
        console.log(count,'å‡½æ•°å†…éƒ¨');
    }
    const add = () => {
        let val = count + 1;
        setCount(val);
        handleClick()
    };
     console.log(count,'å‡½æ•°å¤–é¢');
    return (
        <div>
            <p>You clicked {count} times</p>
            <button onClick={add}>
                ç‚¹å‡»æˆ‘
            </button>
            <button onClick={handleClick}>
                è·å–å€¼
            </button>
        </div>
    );
}
export default Example;
```

![](https://ae01.alicdn.com/kf/H70f6508f638a4c35bb9d095a2a5fde9cE.gif)

ä½ å‘ç°`handleClick`æ¯æ¬¡è·å–çš„éƒ½æ˜¯ä¸Šä¸€æ¬¡çš„å€¼ï¼Œ**å› ä¸ºå®ƒè·å–çš„æ˜¯åˆ›å»ºå®ƒçš„é‚£æ¬¡å€¼**ï¼Œæ­¤æ—¶å¯ä»¥ç”¨`useRef`æ›²çº¿æ•‘å›½

```javascript{4,6,11}
import React, {useState, useRef} from "react";
function Example() {
    const [count, setCount] = useState(0);
    const ref = useRef();
    function handleClick() {
        console.log(count, ref.current);
    }
    const add = () => {
        let val = count + 1;
        setCount(val);
        ref.current = val;
        handleClick()
    };
    return (
        <div>
            <p>You clicked {count} times</p>
            <button onClick={add}>
                ç‚¹å‡»æˆ‘
            </button>
            <button onClick={handleClick}>
                è·å–å€¼
            </button>
        </div>
    );
}
export default Example;
```

## è·å–DOM èŠ‚ç‚¹

```javascript{9,10,11,13,12}
import React, {Fragment,useState, useRef, useCallback} from "react";
function Example() {
    const [width, setWidth] = useState(0);
    // const inputEl = useRef(null)
    // useEffect(() => {
    //      setWidth(inputEl.current.getBoundingClientRect().width);
    // });
          
    let ref = useCallback(node => {
        if (node !== null) {
            setWidth(node.getBoundingClientRect().width);
        }
    }, []);
    return (
        <Fragment>
            <h1 ref={ref}>Hello, world</h1>
            <h2>å½“å‰å±å¹•å®½åº¦ä¸º {Math.round(width)}px</h2>
        </Fragment>
    );
}
export default Example
```
è¿™é‡Œæˆ‘ä»¬æ²¡æœ‰é€‰æ‹©ä½¿ç”¨`useRef`ï¼Œç”¨çš„refçš„å›è°ƒå‡½æ•°ï¼Œå› ä¸ºå½“refæ˜¯ä¸€ä¸ªå¯¹è±¡æ—¶å®ƒå¹¶ä¸ä¼šæŠŠå½“å‰refçš„å€¼çš„å˜åŒ–é€šçŸ¥åˆ°æˆ‘ä»¬ï¼Œæœ€ç»ˆè¿˜æ˜¯è¦å€ŸåŠ©effectæ¥å®ç°ã€Œä»£ç å¦‚ä¸Šã€

**æŠ½ç¦»å‡ºæ¥**

```javascript{3,4,5,6,7,8,9,10,11,14}
import React, {useState, useRef, useCallback} from "react";

const useClientRect = () => {
    const [width, setWidth] = useState(0);
    let ref = useCallback(node => {
        if (node !== null) {
            setWidth(node.getBoundingClientRect().width);
        }
    }, []);
    return [width, ref]
};

function Example() {
    const [width, ref] = useClientRect(0);
    return (
        <>
            <h1 ref={ref}>Hello, world</h1>
            <h2>å½“å‰å±å¹•å®½åº¦ä¸º {Math.round(width)}px</h2>
        </>
    );
}

export default Example
```

## useCallbackç¤ºä¾‹ä½•æ—¶æ›´æ–°

```javascript{5,7,8,9,26,15,16,17,18,19,20,21}
import React, {Fragment, useState, useEffect, useRef, useCallback} from "react";

const set1 = new Set();

let c = 21;//ã€2ã€‘

let obj = {
    name: "wk"
};//ã€1ã€‘å¦‚æœæ˜¯å¯¹è±¡çš„è¯ï¼Œä»–ä¼šæŒ‡å‘ä¸€ä¸ªåœ°å€ï¼Œé™¤éæ”¹å˜åœ°å€ä»–æ‰ä¼šé‡æ–°æ‰§è¡ŒuseCallbackï¼Œå¦åˆ™ä»–è¿”å›çš„æ˜¯ä¸Šæ¬¡ç¼“å­˜çš„å‡½æ•°

function Form() {
    const [text, updateText] = useState('');
    const textRef = useRef();

    useEffect(() => {
        c = Math.random(); //ã€2ã€‘

        textRef.current = text;

        obj = {...textRef}; //ã€1ã€‘
    });

    const handleSubmit = useCallback(() => {
        const currentText = textRef.current;
        console.log((currentText));
    }, [obj]);


    set1.add(handleSubmit);
    console.log(set1.size);

    return (
        <>
            <input value={text} onChange={e => updateText(e.target.value)}/>
            {/*<div>{textRef.current}</div>*/}
            <div>{c}</div>
            <button onClick={handleSubmit}>ç‚¹å‡»</button>
        </>
    );
}

export default Form
```

![](https://ae01.alicdn.com/kf/H7410c03e8eab4361b28a18bfce16c4ba9.gif)

ç”±æ­¤å¯è§objæ¯æ¬¡æ‰§è¡Œéƒ½è¦`æµ…å…‹éš†`ï¼ŒuseCallbackä¾èµ–äº`obj`æ‰€ä»¥æ¯æ¬¡éƒ½ä¼šç”Ÿæˆæ–°çš„å‡½æ•°ã€‚

## useMemoä¼˜åŒ–ç»„ä»¶

```javascript{3,5,8,9}
function Example({ a, b }) {
  // Only re-rendered if `a` changes:
  const child1 = useMemo(() => <Child1 a={a} />, [a]);
  // Only re-rendered if `b` changes:
  const child2 = useMemo(() => <Child2 b={b} />, [b]);
  return (
    <>
      {child1}
      {child2}
    </>
  )
}
export default Example
```
`æ³¨æ„è¿™ç§æ–¹å¼åœ¨å¾ªç¯ä¸­æ˜¯æ— æ•ˆçš„`

## å¦‚ä½•å‘ä¸‹ä¼ é€’å›è°ƒï¼Ÿ

æˆ‘ä»¬å·²ç»å‘ç°å¤§éƒ¨åˆ†äººå¹¶ä¸å–œæ¬¢åœ¨ç»„ä»¶æ ‘çš„æ¯ä¸€å±‚æ‰‹åŠ¨ä¼ é€’å›è°ƒã€‚å°½ç®¡è¿™ç§å†™æ³•æ›´æ˜ç¡®ï¼Œä½†è¿™ç»™äººæ„Ÿè§‰åƒé”™ç»¼å¤æ‚çš„ç®¡é“å·¥ç¨‹ä¸€æ ·éº»çƒ¦ã€‚

åœ¨`å¤§å‹`çš„ç»„ä»¶æ ‘ä¸­å»ºè®®ä½¿ç”¨ context ç”¨ useReducer å¾€ä¸‹ä¼ ä¸€ä¸ª `dispatch` å‡½æ•°ï¼š

```javascript{8}
const TodosDispatch = React.createContext(null);

function TodosApp() {
  // æç¤ºï¼š`dispatch` ä¸ä¼šåœ¨é‡æ–°æ¸²æŸ“ä¹‹é—´å˜åŒ–
  const [todos, dispatch] = useReducer(todosReducer);

  return (
    <TodosDispatch.Provider value={dispatch}>
      <DeepTree todos={todos} />
    </TodosDispatch.Provider>
  );
}
```
```javascript{3,6}
function DeepTree(props) {
  // å¦‚æœæˆ‘ä»¬æƒ³è¦æ‰§è¡Œä¸€ä¸ª actionï¼Œæˆ‘ä»¬å¯ä»¥ä» context ä¸­è·å– dispatchã€‚
  const dispatch = useContext(TodosDispatch);

  function handleClick() {
    dispatch({ type: 'add', text: 'hello' });
  }

  return (
    <button onClick={handleClick}>Add todo</button>
  );
}
```

## è‡ªå®šä¹‰Hooks

### useFetch

```javascript
const useDataApi = (initialUrl, initialData) => {
    
    const [data, setData] = useState(initialData);
    const [url, setUrl] = useState(initialUrl);
    const [isLoading, setIsLoading] = useState(false);
    const [isError, setIsError] = useState(false);

    useEffect(() => {
        const fetchData = async () => {
            setIsError(false);
            setIsLoading(true);
            try {
                const result = await fetch(url).then(response => response.json());
                // const result = await axios.get(url);
                setData(result);
            } catch (error) {
                setIsError(true);
                setData(initialData);
            }
            setIsLoading(false);
        };
    fetchData();
    }, [url]);
    return [{data, isLoading, isError}, setUrl];
};
```

## HooksåŸç†åˆ†æ

### ç®€å•å®ç°ä¸€ä¸ªuseState

```javascript
var _state;
function useState(initialValue){
    _state = _state || initialValue;
    function setState(newState){
        _state = newState;
        render()
    }
    return [_state,setState]
}
```

setStateç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥ä½¿å‡½æ•°ï¼Œå½“ä¸ºå‡½æ•°çš„æ—¶å€™ï¼Œå‚æ•°ä¸ºå½“å‰çš„_state

```js
var _state;
function useState(initialValue){
    _state = _state || initialValue;
    function setState(fun){
        _state = fun(_state) || _state
        render()
    }
    return [_state,setState]
}

setCount(state=>state+1)
```

```javascript
import React from "react";
import ReactDOM from "react-dom";
import { Button } from "antd";
import "./styles.css";

let _state; // æŠŠ state å­˜å‚¨åœ¨å¤–é¢

function useState(initialValue) {
  _state = _state | initialValue; // å¦‚æœæ²¡æœ‰ _stateï¼Œè¯´æ˜æ˜¯ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼ŒæŠŠ initialValue å¤åˆ¶ç»™å®ƒ
  function setState(newState) {
    _state = newState;
    render();
  }
  return [_state, setState];
}

function App() {
  const [count, setCount] = useState(0);
  return (
    <div>
      <div>{count}</div>
      <Button
        onClick={() => {
          setCount(count + 1);
        }}
      >
        ç‚¹å‡»1
      </Button>
    </div>
  );
}

const rootElement = document.getElementById("root");

function render() {
  ReactDOM.render(<App />, rootElement);
}
render();
```

## ç®€å•å®ç°ä¸€ä¸ªuseEffect

dependencies:ä¾èµ–å…³ç³»

Effectæœ‰å‡ ä¸ªç‰¹ç‚¹

- æœ‰ä¸¤ä¸ªå‚æ•° callback å’Œ dependencies æ•°ç»„
- å¦‚æœ dependencies ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆ callback æ¯æ¬¡ render éƒ½ä¼šæ‰§è¡Œ
- å¦‚æœ dependencies å­˜åœ¨ï¼Œåªæœ‰å½“å®ƒå‘ç”Ÿäº†å˜åŒ–ï¼Œ callback æ‰ä¼šæ‰§è¡Œ

```js
let _deps; // _deps è®°å½• useEffect ä¸Šä¸€æ¬¡çš„ ä¾èµ–

function useEffect(callback, depArray) {
  const hasNoDeps = !depArray; // å¦‚æœ dependencies ä¸å­˜åœ¨
  const hasChangedDeps = (_deps
    ? !depArray.every((el, i) => el === _deps[i]) // ä¸¤æ¬¡çš„ dependencies æ˜¯å¦å®Œå…¨ç›¸ç­‰
    : true);
  /* å¦‚æœ dependencies ä¸å­˜åœ¨ï¼Œæˆ–è€… dependencies æœ‰å˜åŒ–*/
  if (hasNoDeps || hasChangedDeps) {
    callback();
    _deps = depArray;
  }
}
```

åˆ°ç°åœ¨çš„è¯ï¼Œåœ¨é¡µé¢èƒ½æ­£å¸¸ä½¿ç”¨äº†ï¼Œä½†æ˜¯æ¯æ¬¡ä½¿ç”¨åªèƒ½ç”¨ä¸€æ¬¡ï¼Œå› ä¸ºä½ å£°æ˜å¤šæ¬¡çš„è¯ï¼Œå®ƒæ˜¯å…¬ç”¨çš„ä¸€ä¸ªå˜é‡ï¼Œä¸èƒ½é‡å¤ä½¿ç”¨ã€‚

ä»¬å¯ä»¥ä½¿ç”¨æ•°ç»„ï¼Œæ¥è§£å†³ Hooks çš„å¤ç”¨é—®é¢˜

**ä»£ç å…³é”®åœ¨äºï¼š**

åˆæ¬¡æ¸²æŸ“çš„æ—¶å€™ï¼ŒæŒ‰ç…§ `useStateï¼ŒuseEffect` çš„é¡ºåºï¼ŒæŠŠ `stateï¼Œdeps` ç­‰æŒ‰é¡ºåºå¡åˆ° `memoizedState` æ•°ç»„ä¸­ã€‚
æ›´æ–°çš„æ—¶å€™ï¼ŒæŒ‰ç…§é¡ºåºï¼Œä» `memoizedState` ä¸­æŠŠä¸Šæ¬¡è®°å½•çš„å€¼æ‹¿å‡ºæ¥ã€‚

```javascript
let memoizedState = []; // hooks å­˜æ”¾åœ¨è¿™ä¸ªæ•°ç»„
let cursor = 0; // å½“å‰ memoizedState ä¸‹æ ‡

function useState(initialValue) {
  memoizedState[cursor] = memoizedState[cursor] || initialValue;
  const currentCursor = cursor;
  function setState(newState) {
    memoizedState[currentCursor] = newState;
    render();
  }
  return [memoizedState[cursor++], setState]; // è¿”å›å½“å‰ stateï¼Œå¹¶æŠŠ cursor åŠ  1
}

function useEffect(callback, depArray) {
  const hasNoDeps = !depArray;
  const deps = memoizedState[cursor];
  const hasChangedDeps = (deps
    ? !depArray.every((el, i) => el === deps[i])
    : true);
  if (hasNoDeps || hasChangedDeps) {
    callback();
    memoizedState[cursor] = depArray;
  }
  cursor++;
}
```

åˆ°è¿™é‡ŒåŸºæœ¬çš„ä¸šåŠ¡å·²ç»æ»¡è¶³äº†ï¼Œä½†æ˜¯æœ‰å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼š

- memoizedState æ•°ç»„æ˜¯æŒ‰ hookå®šä¹‰çš„é¡ºåºæ¥æ”¾ç½®æ•°æ®çš„ï¼Œå¦‚æœhooksçš„é¡ºåºå˜åŒ–ï¼ŒmemoizedState å¹¶ä¸ä¼šæ„ŸçŸ¥åˆ°æ‰€ä»¥ä¸è¦å†å¾ªç¯æˆ–è€…åˆ¤æ–­è¯­å¥ä¸­è°ƒç”¨ã€‚
- è‡ªå®šä¹‰çš„hooksä¹Ÿæ˜¯å…±äº«åŒä¸€ä¸ª memoizedStateï¼Œå…±äº«åŒä¸€ä¸ªé¡ºåºã€‚

## å‚è€ƒæ–‡æ¡£

[hooks](https://react.docschina.org/docs/hooks-reference.html)

[react-hooks-fetch](https://www.robinwieruch.de/react-hooks)

[hooks-faq](https://react.docschina.org/docs/hooks-faq.html)

[ReactHooksæºç ](https://github.com/facebook/react/blob/master/packages/react/src/ReactHooks.js)
