import{_ as s,c as n,o as a,a5 as l}from"./chunks/framework.BQQWXjGs.js";const u=JSON.parse('{"title":"React-SSR","description":"","frontmatter":{},"headers":[],"relativePath":"workspace/Frame/react/ssr.md","filePath":"workspace/Frame/react/ssr.md","lastUpdated":1713942612000}'),p={name:"workspace/Frame/react/ssr.md"},e=l(`<h1 id="react-ssr" tabindex="-1">React-SSR <a class="header-anchor" href="#react-ssr" aria-label="Permalink to &quot;React-SSR&quot;">â€‹</a></h1><p>å…ˆé™„ä¸Šgithubåœ°å€<a href="https://github.com/wkvictory/react-ssr,%E6%96%B9%E4%BE%BF%E5%A4%A7%E5%AE%B6%E6%9B%B4%E5%AE%B9%E6%98%93%E7%90%86%E8%A7%A3%EF%BC%8C%E4%B8%8D%E7%84%B6%E5%90%8E%E9%9D%A2%E5%BE%88%E5%A4%9A%E5%9C%B0%E6%96%B9%E4%BC%9A%E4%B8%80%E5%A4%B4%E9%9B%BE%E6%B0%B4%E3%80%82" target="_blank" rel="noreferrer">https://github.com/wkvictory/react-ssr,æ–¹ä¾¿å¤§å®¶æ›´å®¹æ˜“ç†è§£ï¼Œä¸ç„¶åé¢å¾ˆå¤šåœ°æ–¹ä¼šä¸€å¤´é›¾æ°´ã€‚</a></p><p>æ¬¢è¿å¤§å®¶ç‚¹star,æissueï¼Œä¸€èµ·è¿›æ­¥ï¼ğŸ˜„</p><h2 id="å®¢æˆ·ç«¯æ¸²æŸ“ä¸æœåŠ¡ç«¯æ¸²æŸ“" tabindex="-1">å®¢æˆ·ç«¯æ¸²æŸ“ä¸æœåŠ¡ç«¯æ¸²æŸ“ <a class="header-anchor" href="#å®¢æˆ·ç«¯æ¸²æŸ“ä¸æœåŠ¡ç«¯æ¸²æŸ“" aria-label="Permalink to &quot;å®¢æˆ·ç«¯æ¸²æŸ“ä¸æœåŠ¡ç«¯æ¸²æŸ“&quot;">â€‹</a></h2><p><strong>CSR:</strong></p><p>é¡µé¢æ¸²æŸ“æ˜¯JSè´Ÿè´£è¿›è¡Œçš„</p><p>æµè§ˆå™¨å‘é€è¯·æ±‚â€“&gt;æœåŠ¡å™¨è¿”å›HTMLâ€“&gt;æµè§ˆå™¨å‘é€bundle.jsè¯·æ±‚â€“&gt;æœåŠ¡å™¨è¿”å›bundle.jsâ€“&gt;æµè§ˆå™¨æ‰§è¡Œbundle.jsä¸­çš„reactä»£ç å®Œæˆæ¸²æŸ“</p><p><strong>SSR:</strong></p><p>æœåŠ¡å™¨ç«¯ç›´æ¥è¿”å›HTMLè®©æµè§ˆå™¨ç›´æ¥æ¸²æŸ“</p><p>æµè§ˆå™¨å‘é€è¯·æ±‚â€“&gt;æœåŠ¡å™¨è¿è¡ŒReactä»£ç ç”Ÿæˆé¡µé¢â€“&gt;æœåŠ¡å™¨è¿”å›é¡µé¢</p><p><strong>ä¼ ç»ŸCSRçš„å¼Šç«¯:</strong></p><ol><li><p>ç”±äºé¡µé¢æ˜¾ç¤ºè¿‡ç¨‹è¦è¿›è¡ŒJSæ–‡ä»¶æ‹‰å–å’ŒReactä»£ç æ‰§è¡Œï¼Œåœ¨è¿™ä¸ªæ¸²æŸ“è¿‡ç¨‹ä¸­è‡³å°‘æ¶‰åŠåˆ°ä¸¤ä¸ª HTTPè¯·æ±‚å‘¨æœŸï¼ˆhtml+jsï¼‰ï¼Œæ‰€ä»¥ä¼šæœ‰ä¸€å®šçš„è€—æ—¶ï¼Œé¦–å±åŠ è½½æ—¶é—´ä¼šæ¯”è¾ƒæ…¢ã€‚</p></li><li><p>å¯¹äºSEO(Search Engine Optimazition,å³æœç´¢å¼•æ“ä¼˜åŒ–)ï¼Œå®Œå…¨æ— èƒ½ä¸ºåŠ›ï¼Œå› ä¸ºæœç´¢å¼•æ“çˆ¬è™«åªè®¤è¯†htmlç»“æ„çš„å†…å®¹ï¼Œè€Œä¸èƒ½è¯†åˆ«JSä»£ç å†…å®¹ã€‚</p></li></ol><p><strong>SSRçš„å¼Šç«¯:</strong></p><p>ssrçš„å‡ºç°ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³è¿™äº›ä¼ ç»ŸCSRçš„å¼Šç«¯</p><p>åœ¨ React ä¸­ä½¿ç”¨ ssr æŠ€æœ¯ï¼Œæˆ‘ä»¬è®© React ä»£ç åœ¨æœåŠ¡å™¨ç«¯å…ˆæ‰§è¡Œä¸€æ¬¡ï¼Œä½¿å¾—ç”¨æˆ·ä¸‹è½½çš„ HTML å·²ç»åŒ…å«äº†æ‰€æœ‰çš„é¡µé¢å±•ç¤ºå†…å®¹ï¼Œè¿™æ ·ï¼Œé¡µé¢å±•ç¤ºçš„è¿‡ç¨‹åªéœ€è¦ç»å†ä¸€ä¸ª HTTP è¯·æ±‚å‘¨æœŸï¼ŒTTFPï¼ˆTime To First Pageï¼‰ æ—¶é—´å¾—åˆ°ä¸€å€ä»¥ä¸Šçš„ç¼©å‡</p><p>ä½†æ˜¯ä½¿ç”¨ ssr è¿™ç§æŠ€æœ¯ï¼Œå°†ä½¿åŸæœ¬ç®€å•çš„ React é¡¹ç›®å˜å¾—éå¸¸å¤æ‚</p><ol><li><p>ç›¸å¯¹äºä»…ä»…éœ€è¦æä¾›é™æ€æ–‡ä»¶çš„æœåŠ¡å™¨ï¼Œssrä¸­ä½¿ç”¨çš„æ¸²æŸ“ç¨‹åºè‡ªç„¶ä¼šå ç”¨æ›´å¤šçš„CPUå’Œå†…å­˜èµ„æº</p></li><li><p>åœ¨æœåŠ¡å™¨ç”Ÿæˆçš„é¡µé¢æ‰€ä»¥ï¼Œä¸€äº›å¸¸ç”¨çš„æµè§ˆå™¨APIå¯èƒ½æ— æ³•æ­£å¸¸ä½¿ç”¨ï¼Œæ¯”å¦‚windowã€docmentå’Œalertç­‰ï¼Œå¦‚æœä½¿ç”¨çš„è¯éœ€è¦å¯¹è¿è¡Œçš„ç¯å¢ƒåŠ ä»¥åˆ¤æ–­</p></li><li><p>å¼€å‘è°ƒè¯•ä¼šæœ‰ä¸€äº›éº»çƒ¦ï¼Œå› ä¸ºæ¶‰åŠäº†æµè§ˆå™¨åŠæœåŠ¡å™¨ï¼Œå¯¹äºSPAçš„ä¸€äº›ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ä¼šå˜å¾—å¤æ‚</p></li><li><p>å¯èƒ½ä¼šç”±äºæŸäº›å› ç´ å¯¼è‡´æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„ç»“æœä¸æµè§ˆå™¨ç«¯çš„ç»“æœä¸ä¸€è‡´ï¼Œé¡¹ç›®çš„å¯ç»´æŠ¤æ€§ä¼šé™ä½ï¼Œä»£ç é—®é¢˜çš„è¿½æº¯ä¹Ÿä¼šå˜å¾—å›°éš¾</p></li></ol><p>æ‰€ä»¥ï¼Œä½¿ç”¨ ssr åœ¨è§£å†³é—®é¢˜çš„åŒæ—¶ï¼Œä¹Ÿä¼šå¸¦æ¥éå¸¸å¤šçš„å‰¯ä½œç”¨ï¼Œæœ‰çš„æ—¶å€™ï¼Œè¿™äº›å‰¯ä½œç”¨çš„ä¼¤å®³æ¯”èµ· ssr æŠ€æœ¯å¸¦æ¥çš„ä¼˜åŠ¿è¦å¤§çš„å¤šã€‚ä¸€èˆ¬å»ºè®®ssrï¼Œé™¤éä½ çš„é¡¹ç›®ç‰¹åˆ«ä¾èµ–æœç´¢å¼•æ“æµé‡ï¼Œæˆ–è€…å¯¹é¦–å±æ—¶é—´æœ‰ç‰¹æ®Šçš„è¦æ±‚ï¼Œå¦åˆ™ä¸å»ºè®®ä½¿ç”¨ ssr,å¦‚æœåªå¯¹seoæœ‰è¦æ±‚å¯ä½¿ç”¨ <a href="https://github.com/prerender/prerender" target="_blank" rel="noreferrer">prerenderé¢„æ¸²æŸ“</a>ã€‚</p><h2 id="ssrçš„å®ç°æœ¬è´¨" tabindex="-1">SSRçš„å®ç°æœ¬è´¨ <a class="header-anchor" href="#ssrçš„å®ç°æœ¬è´¨" aria-label="Permalink to &quot;SSRçš„å®ç°æœ¬è´¨&quot;">â€‹</a></h2><p>è¿™é‡Œä»‹ç»çš„æ˜¯ssrï¼Œæ˜¯åŸºäºReact çš„SPAé¡¹ç›®ï¼Œä¸æ˜¯åƒ thinkphpã€jspã€nodeJs+ejs è¿™ç§çº¯åç«¯ç›´å‡ºæ¸²æŸ“æ–¹å¼ï¼Œæ‰€ä»¥è¿™ç§å¤§å¤šæ•°åªæ˜¯é’ˆå¯¹é¦–å±çš„ssr,å› ä¸ºæµè§ˆå™¨çš„è·¯ç”±è·³è½¬æ–¹å¼æ˜¯ç”¨çš„H5çš„<code>history API</code>çš„<code>window.history.pushState()</code> ï¼Œä½¿å¾—æˆ‘ä»¬å³å¯ä»¥ä¿®æ”¹ <code>url</code> ä¹Ÿå¯ä»¥ä¸åˆ·æ–°é¡µé¢ï¼Œæ‰€ä»¥æ˜¯ä¸ä¼šèµ°æœåŠ¡ç«¯çš„ã€å¯ä»¥é€šè¿‡é¢„åŠ è½½è·å–éœ€è¦çš„æ•°æ®ã€‘ã€‚</p><p><strong>ssr ä¹‹æ‰€ä»¥èƒ½å¤Ÿå®ç°ï¼Œæœ¬è´¨ä¸Šæ˜¯å› ä¸ºè™šæ‹Ÿ DOM çš„å­˜åœ¨</strong></p><p>ssr çš„å·¥ç¨‹ä¸­ï¼ŒReact ä»£ç ä¼šåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å„æ‰§è¡Œä¸€æ¬¡,å› ä¸ºä»£ç åœ¨ Node ç¯å¢ƒä¸‹æ˜¯æ²¡æœ‰DOMè¿™ä¸ªæ¦‚å¿µçš„ï¼Œæ‰€ä»¥åœ¨React æ¡†æ¶ä¸­å¼•å…¥äº†ä¸€ä¸ªæ¦‚å¿µå«åšè™šæ‹Ÿ DOMï¼ŒReact åœ¨åšé¡µé¢æ“ä½œæ—¶ï¼Œå®é™…ä¸Šä¸æ˜¯ç›´æ¥æ“ä½œ DOMï¼Œè€Œæ˜¯æ“ä½œè™šæ‹Ÿ DOMï¼Œä¹Ÿå°±æ˜¯æ“ä½œæ™®é€šçš„ JavaScript å¯¹è±¡ï¼Œè¿™å°±ä½¿å¾— ssr æˆä¸ºäº†å¯èƒ½ã€‚åœ¨æœåŠ¡å™¨ï¼Œæˆ‘å¯ä»¥æ“ä½œ JavaScript å¯¹è±¡ï¼Œåˆ¤æ–­ç¯å¢ƒæ˜¯æœåŠ¡å™¨ç¯å¢ƒï¼Œæˆ‘ä»¬æŠŠè™šæ‹Ÿ DOM æ˜ å°„æˆå­—ç¬¦ä¸²è¾“å‡ºï¼›åœ¨å®¢æˆ·ç«¯ï¼Œæˆ‘ä¹Ÿå¯ä»¥æ“ä½œ JavaScript å¯¹è±¡ï¼Œåˆ¤æ–­ç¯å¢ƒæ˜¯å®¢æˆ·ç«¯ç¯å¢ƒï¼Œæˆ‘å°±ç›´æ¥å°†è™šæ‹Ÿ DOM æ˜ å°„æˆçœŸå® DOMï¼Œå®Œæˆé¡µé¢æŒ‚è½½ã€‚</p><h2 id="æ–¹æ¡ˆç­›é€‰" tabindex="-1">æ–¹æ¡ˆç­›é€‰ <a class="header-anchor" href="#æ–¹æ¡ˆç­›é€‰" aria-label="Permalink to &quot;æ–¹æ¡ˆç­›é€‰&quot;">â€‹</a></h2><ul><li><a href="./[https://nextjs.frontendx.cn/docs/#å®‰è£…](https://nextjs.frontendx.cn/docs/#å®‰è£…)">next.js</a>/<a href="https://www.nuxtjs.cn/guide/installation" target="_blank" rel="noreferrer">nuxt.js</a> æˆæœ¬ä½,å®‰å¿ƒçš„å†™é¡µé¢å°±è¡Œäº†ï¼Œæ— éœ€è¿‡å¤šå…³å¿ƒæœåŠ¡ç«¯è·¯ç”±ï¼ˆå¤šé¡µé¢åº”ç”¨ï¼Œæ–°æ¡†æ¶ï¼‰</li><li><a href="https://github.com/wkvictory/prerender" target="_blank" rel="noreferrer">prerender </a>å®ç°spaé¡¹ç›®çš„æœåŠ¡ç«¯é¢„æ¸²æŸ“</li><li>ä½¿ç”¨è°·æ­Œ <a href="https://github.com/wkvictory/rendertron" target="_blank" rel="noreferrer">rendertron</a> å®ç°spaé¡¹ç›®çš„æœåŠ¡ç«¯æ¸²æŸ“ ã€æ®è¯´ä¼šè¢«åˆ¤ä½œå¼Šçš„ï¼Œé™æƒå¤„ç†ã€‘</li><li>ç§‰æ‰¿å­¦ä¹ çš„æ€åº¦äº†è§£ä¸‹åŸºæœ¬åŸç†ï¼Œé€‰æ‹©äº†è‡ªå·±å»æ­ï¼Œï¼ˆä¸­é—´æ–­äº†ä¸€æ®µæ—¶é—´ï¼Œç°åœ¨åˆé‡æ–°æ‹¾èµ·æ¥ï¼‰ï¼Œä¹‹å‰çœ‹åˆ°æœ‰äººç”¨ react + redux + Express æ­ssrçš„æ–‡ç« ï¼Œæ‰€ä»¥åŸºäºå¯¹dvaå’Œkoaçš„ç†Ÿæ‚‰å’Œç‰¹åˆ«å–œå¥½ï¼Œå°±ç›´æ¥é€‰æ‹©äº†dva-core + koa åšçŠ¶æ€ç®¡ç†æ­å»ºã€‚</li></ul><h2 id="koaå®ç°åŸºç¡€ç‰ˆæœ¬çš„ssr" tabindex="-1">Koaå®ç°åŸºç¡€ç‰ˆæœ¬çš„SSR <a class="header-anchor" href="#koaå®ç°åŸºç¡€ç‰ˆæœ¬çš„ssr" aria-label="Permalink to &quot;Koaå®ç°åŸºç¡€ç‰ˆæœ¬çš„SSR&quot;">â€‹</a></h2><h3 id="ä¸ä½¿ç”¨koa-router" tabindex="-1">ä¸ä½¿ç”¨koa-router <a class="header-anchor" href="#ä¸ä½¿ç”¨koa-router" aria-label="Permalink to &quot;ä¸ä½¿ç”¨koa-router&quot;">â€‹</a></h3><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> Koa</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;koa&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> app</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> Koa</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">use</span><span style="color:#ABB2BF;">((</span><span style="color:#E06C75;font-style:italic;">ctx</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">  if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">path</span><span style="color:#56B6C2;"> ===</span><span style="color:#98C379;"> &#39;/&#39;</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;">    ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">body</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#98C379;">      \`</span></span>
<span class="line"><span style="color:#98C379;">     &lt;html&gt;</span></span>
<span class="line"><span style="color:#98C379;">       &lt;head&gt;</span></span>
<span class="line"><span style="color:#98C379;">         &lt;title&gt;ç¦¾å£å’Œssr&lt;/title&gt;</span></span>
<span class="line"><span style="color:#98C379;">       &lt;/head&gt;</span></span>
<span class="line"><span style="color:#98C379;">       &lt;body&gt;</span></span>
<span class="line"><span style="color:#98C379;">         &lt;h1&gt;hello&lt;/h1&gt;</span></span>
<span class="line"><span style="color:#98C379;">         &lt;h2&gt;world&lt;/h2&gt;</span></span>
<span class="line"><span style="color:#98C379;">       &lt;/body&gt;</span></span>
<span class="line"><span style="color:#98C379;">     &lt;/html&gt;</span></span>
<span class="line"><span style="color:#98C379;">     \`</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">})</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> server</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">listen</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;9999&#39;</span><span style="color:#ABB2BF;">, () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">  const</span><span style="color:#ABB2BF;"> {</span><span style="color:#E5C07B;">port</span><span style="color:#ABB2BF;">} </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> server</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">address</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">  console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">\`http://localhost:</span><span style="color:#C678DD;">\${</span><span style="color:#E06C75;">port</span><span style="color:#C678DD;">}</span><span style="color:#98C379;">\`</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="ä½¿ç”¨koa-router" tabindex="-1">ä½¿ç”¨koa-router <a class="header-anchor" href="#ä½¿ç”¨koa-router" aria-label="Permalink to &quot;ä½¿ç”¨koa-router&quot;">â€‹</a></h3><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> Koa</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;koa&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> app</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> Koa</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> route</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;koa-router&quot;</span><span style="color:#ABB2BF;">)() </span><span style="color:#7F848E;font-style:italic;">// è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨æ„é€ å‡½æ•°</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">route</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/&quot;</span><span style="color:#ABB2BF;">, (</span><span style="color:#E06C75;font-style:italic;">ctx</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">  ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">body</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#98C379;">    \`</span></span>
<span class="line"><span style="color:#98C379;">   &lt;html&gt;</span></span>
<span class="line"><span style="color:#98C379;">       &lt;head&gt;</span></span>
<span class="line"><span style="color:#98C379;">         &lt;title&gt;ç¦¾å£å’Œssr&lt;/title&gt;</span></span>
<span class="line"><span style="color:#98C379;">       &lt;/head&gt;</span></span>
<span class="line"><span style="color:#98C379;">       &lt;body&gt;</span></span>
<span class="line"><span style="color:#98C379;">         &lt;h1&gt;hello&lt;/h1&gt;</span></span>
<span class="line"><span style="color:#98C379;">         &lt;h2&gt;world&lt;/h2&gt;</span></span>
<span class="line"><span style="color:#98C379;">       &lt;/body&gt;</span></span>
<span class="line"><span style="color:#98C379;">     &lt;/html&gt;</span></span>
<span class="line"><span style="color:#98C379;">    \`</span></span>
<span class="line"><span style="color:#ABB2BF;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">use</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">route</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">routes</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">use</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">route</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">allowedMethods</span><span style="color:#ABB2BF;">()); </span><span style="color:#7F848E;font-style:italic;">//è‡ªåŠ¨è®¾ç½®å“åº”å¤´ctx.statuså®Œå–„responseå“åº”å¤´</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> server</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">listen</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;9999&#39;</span><span style="color:#ABB2BF;">, () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">  const</span><span style="color:#ABB2BF;"> {</span><span style="color:#E5C07B;">port</span><span style="color:#ABB2BF;">} </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> server</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">address</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">  console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">\`http://localhost:</span><span style="color:#C678DD;">\${</span><span style="color:#E06C75;">port</span><span style="color:#C678DD;">}</span><span style="color:#98C379;">\`</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>è¿™æ ·ä¸€ä¸ªç®€å•çš„æœåŠ¡ç«¯æ¸²æŸ“å°±æå®šäº†ï¼ŒæœåŠ¡å™¨ç«¯ç›´æ¥è¿”å›HTMLè®©æµè§ˆå™¨ç›´æ¥æ¸²æŸ“ï¼Œè€Œä¸”ç½‘é¡µæºä»£ç ä¸­æ˜¯æœ‰è¿™äº›domä¿¡æ¯çš„å¯¹seoéå¸¸å‹å¥½ï¼Œæˆ‘ä»¬reactã€vueè¿™äº›éƒ½æ˜¯é€šè¿‡webpackå¼•å…¥äº†js,æ‰€æœ‰çš„åŠŸèƒ½é¡µé¢å±•ç¤ºç»Ÿç»Ÿç”±jså®Œæˆã€‚</p><h2 id="å®ç°reactç»„ä»¶çš„æœåŠ¡ç«¯æ¸²æŸ“" tabindex="-1">å®ç°Reactç»„ä»¶çš„æœåŠ¡ç«¯æ¸²æŸ“ <a class="header-anchor" href="#å®ç°reactç»„ä»¶çš„æœåŠ¡ç«¯æ¸²æŸ“" aria-label="Permalink to &quot;å®ç°Reactç»„ä»¶çš„æœåŠ¡ç«¯æ¸²æŸ“&quot;">â€‹</a></h2><p>åˆ°è¿™ä¸€æ­¥å·²ç»ä¸èƒ½ç›´æ¥ç”¨nodeå¯åŠ¨æœåŠ¡äº†ï¼Œå› ä¸ºæ²¡æœ‰<code>babel</code>ï¼Œ Reactä¸ä¼šè½¬åŒ–æˆ<code>createElement</code>çš„å½¢å¼ï¼Œè€Œä¸”ä½¿ç”¨nodeä¹Ÿä¸èƒ½ç›´æ¥ä½¿ç”¨importå¯¼å…¥æ–¹å¼ã€‚</p><p>éšä¾¿ç¼–å†™ä¸€ä¸ªReactçš„ç»„ä»¶</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// src/pages/home</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> React</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &#39;react&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#61AFEF;"> Home</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">  return</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">div</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;</span><span style="color:#E06C75;">div</span><span style="color:#ABB2BF;">&gt;Homeç»„ä»¶&lt;/</span><span style="color:#E06C75;">div</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;">div</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  )</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#C678DD;">export</span><span style="color:#C678DD;"> default</span><span style="color:#E06C75;"> Home</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>ç„¶åæˆ‘ä»¬æŠŠå½“å‰ç»„ä»¶ï¼Œä½¿ç”¨æœåŠ¡å‘˜æ¸²æŸ“å‡ºæ¥ï¼Œçœ‹ä¸‹é¢é…ç½®ï¼š</p><h3 id="webpack-base" tabindex="-1">Webpack base <a class="header-anchor" href="#webpack-base" aria-label="Permalink to &quot;Webpack base&quot;">â€‹</a></h3><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// config/webpack.base.js</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> path</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;path&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">module</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">exports</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;">  module</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">    rules</span><span style="color:#ABB2BF;">: [{</span></span>
<span class="line"><span style="color:#E06C75;">      test</span><span style="color:#ABB2BF;">:</span><span style="color:#E06C75;"> /</span><span style="color:#56B6C2;">\\.</span><span style="color:#E06C75;">js</span><span style="color:#ABB2BF;">|</span><span style="color:#E06C75;">jsx</span><span style="color:#C678DD;">$</span><span style="color:#E06C75;">/</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">      loader</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;babel-loader&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">      exclude</span><span style="color:#ABB2BF;">:</span><span style="color:#E06C75;"> /node_modules/</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">      options</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">        presets</span><span style="color:#ABB2BF;">: [</span><span style="color:#98C379;">&#39;@babel/preset-react&#39;</span><span style="color:#ABB2BF;">, [</span><span style="color:#98C379;">&#39;@babel/preset-env&#39;</span><span style="color:#ABB2BF;">, {</span></span>
<span class="line"><span style="color:#E06C75;">          targets</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">            browsers</span><span style="color:#ABB2BF;">: [</span><span style="color:#98C379;">&#39;last 2 versions&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">          }</span></span>
<span class="line"><span style="color:#ABB2BF;">        }]]</span></span>
<span class="line"><span style="color:#ABB2BF;">      }</span></span>
<span class="line"><span style="color:#ABB2BF;">    }]</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="æœåŠ¡å™¨ç«¯-webpack-é…ç½®" tabindex="-1">æœåŠ¡å™¨ç«¯ Webpack é…ç½® <a class="header-anchor" href="#æœåŠ¡å™¨ç«¯-webpack-é…ç½®" aria-label="Permalink to &quot;æœåŠ¡å™¨ç«¯ Webpack é…ç½®&quot;">â€‹</a></h3><p>æœåŠ¡ç«¯è¿è¡Œçš„ä»£ç å¦‚æœéœ€è¦ä¾èµ– Node æ ¸å¿ƒæ¨¡å—æˆ–è€…ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œ<code>å°±ä¸å†éœ€è¦æŠŠå®¢æˆ·ç«¯çš„ä¸€äº›æ¨¡å—ä»£ç æ‰“åŒ…åˆ°æœ€ç»ˆä»£ç ä¸­äº†</code>ã€‚å› ä¸ºç¯å¢ƒå·²ç»å®‰è£…è¿™äº›ä¾èµ–ï¼Œå¯ä»¥ç›´æ¥å¼•ç”¨ã€‚è¿™æ ·ä¸€æ¥ï¼Œå°±éœ€è¦æˆ‘ä»¬åœ¨ webpack ä¸­é…ç½®ï¼š<code>targetï¼šnode</code>ï¼Œå¹¶å€ŸåŠ© webpack-node-externals æ’ä»¶ï¼Œè§£å†³ç¬¬ä¸‰æ–¹ä¾èµ–æ‰“åŒ…çš„é—®é¢˜ã€‚</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// config/webpack.server.js</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> path</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;path&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> nodeExternals</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;webpack-node-externals&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> merge</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;webpack-merge&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> config</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;./webpack.base&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> serverConfig</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;">  target</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;node&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#7F848E;font-style:italic;">// ç¼–è¯‘å‡ºèƒ½è®©nodeè¯†åˆ«çš„ä»£ç   https://webpack.docschina.org/concepts/targets/</span></span>
<span class="line"><span style="color:#E06C75;">  mode</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;development&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#7F848E;font-style:italic;">// è¿™é‡Œçš„modeè¦ç‰¹åˆ«æ³¨æ„</span></span>
<span class="line"><span style="color:#E06C75;">  entry</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;./src/server/index.js&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#7F848E;font-style:italic;">// å¯¹åº”æœåŠ¡ç«¯çš„ä»£ç </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  // https://webpack.docschina.org/configuration/externals/</span></span>
<span class="line"><span style="color:#E06C75;">  externals</span><span style="color:#ABB2BF;">: [</span><span style="color:#61AFEF;">nodeExternals</span><span style="color:#ABB2BF;">()], </span><span style="color:#7F848E;font-style:italic;">// ä¸ºäº†å¿½ç•¥node_modulesæ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ¨¡å—</span></span>
<span class="line"><span style="color:#E06C75;">  output</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">    filename</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;bundle.js&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">    path</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">path</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">resolve</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">__dirname</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;../bundle&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#E5C07B;">module</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">exports</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> merge</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">config</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">serverConfig</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong>target: &#39;node&#39; å’Œ target: &#39;web&#39; çš„å¤§è‡´åŒºåˆ«</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// target: &#39;node&#39;</span></span>
<span class="line"><span style="color:#E5C07B;">exports</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">ids</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> [</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">];</span></span>
<span class="line"><span style="color:#E5C07B;">exports</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">modules</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {};</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// target: &#39;web&#39; </span></span>
<span class="line"><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">window</span><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&quot;webpackJsonp&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> window</span><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&quot;webpackJsonp&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">||</span><span style="color:#ABB2BF;"> []).</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">([[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">],{</span></span>
<span class="line"><span style="color:#ABB2BF;">}])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// server/index.js</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> Koa</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &#39;koa&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> Router</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &quot;koa-router&quot;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> React</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &quot;react&quot;</span><span style="color:#ABB2BF;">; </span><span style="color:#7F848E;font-style:italic;">// å¿…é¡»å¼•å…¥</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> {</span><span style="color:#E06C75;">renderToString</span><span style="color:#ABB2BF;">} </span><span style="color:#C678DD;">from</span><span style="color:#98C379;"> &#39;react-dom/server&#39;</span><span style="color:#ABB2BF;">; </span><span style="color:#7F848E;font-style:italic;">// react-domæä¾›çš„æ–¹æ³•</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> Home</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &quot;../src/pages/home&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> app</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> Koa</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> route</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> Router</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> content</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> renderToString</span><span style="color:#ABB2BF;">(&lt;</span><span style="color:#E5C07B;">Home</span><span style="color:#ABB2BF;">/&gt;);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">route</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/&quot;</span><span style="color:#ABB2BF;">, (</span><span style="color:#E06C75;font-style:italic;">ctx</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">  ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">body</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#98C379;">    \`</span></span>
<span class="line"><span style="color:#98C379;">    &lt;html&gt;</span></span>
<span class="line"><span style="color:#98C379;">      &lt;head&gt;</span></span>
<span class="line"><span style="color:#98C379;">        &lt;title&gt;ç¦¾å£å’Œssr&lt;/title&gt;</span></span>
<span class="line"><span style="color:#98C379;">      &lt;/head&gt;</span></span>
<span class="line"><span style="color:#98C379;">      &lt;body&gt;</span></span>
<span class="line"><span style="color:#98C379;">        &lt;div id=&quot;root&quot;&gt;</span><span style="color:#C678DD;">\${</span><span style="color:#E06C75;">content</span><span style="color:#C678DD;">}</span><span style="color:#98C379;">&lt;/div&gt;</span></span>
<span class="line"><span style="color:#98C379;">      &lt;/body&gt;</span></span>
<span class="line"><span style="color:#98C379;">    &lt;/html&gt;</span></span>
<span class="line"><span style="color:#98C379;">    \`</span></span>
<span class="line"><span style="color:#ABB2BF;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">use</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">route</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">routes</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">use</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">route</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">allowedMethods</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> server</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">listen</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;9999&#39;</span><span style="color:#ABB2BF;">, () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">  const</span><span style="color:#ABB2BF;"> {</span><span style="color:#E5C07B;">port</span><span style="color:#ABB2BF;">} </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> server</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">address</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">  console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">\`http://localhost:</span><span style="color:#C678DD;">\${</span><span style="color:#E06C75;">port</span><span style="color:#C678DD;">}</span><span style="color:#98C379;">\`</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>ä»¥ä¸Šä½¿ç”¨äº†<strong>renderToString</strong>, æˆ‘ä»¬éƒ½çŸ¥é“react-domæä¾›äº†å››ç§æœåŠ¡ç«¯æ¸²æŸ“å‡½æ•°,å¦‚ä¸‹:</p><ol><li><strong>renderToString</strong>ï¼šå°† React Component è½¬åŒ–ä¸º HTML å­—ç¬¦ä¸²ï¼Œç”Ÿæˆçš„ HTML çš„ DOM ä¼šå¸¦æœ‰é¢å¤–å±æ€§ï¼šå„ä¸ª DOM ä¼šæœ‰data-react-idå±æ€§ï¼Œç¬¬ä¸€ä¸ª DOM ä¼šæœ‰data-reactrootå±æ€§ã€‚</li><li><strong>renderToStaticMarkup</strong>ï¼šå°† React Component è½¬åŒ–ä¸º HTML å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ç”Ÿæˆ HTML çš„ DOM ä¸ä¼šæœ‰é¢å¤–å±æ€§ï¼Œä»è€ŒèŠ‚çœ HTML å­—ç¬¦ä¸²çš„å¤§å°ã€‚</li><li><strong>renderToNodeStream:</strong> ä»¥æµçš„å½¢å¼è¾“å‡ºhtml, ä¸ç”¨åƒrenderToStringç”Ÿæˆæ•´ä¸ªhtmlæ‰å‘é€ç»™å®¢æˆ·ç«¯ã€‚ç›¸å¯¹äºrenderToStringèƒ½æ›´å¿«çš„å“åº”å®¢æˆ·ç«¯ï¼Œæå‡é¡µé¢æ¸²æŸ“é€Ÿåº¦ã€‚</li><li><strong>renderToStaticNodeStream</strong>ï¼šå’Œ renderToNodeStreamä¸€æ ·ï¼Œä¹Ÿæ˜¯è¾“å‡ºæµï¼Œä½†æ˜¯htmlä¸­ä¸å¸¦data-reactrootç­‰å±æ€§ã€‚</li></ol><p><strong>å¯¹äºæœåŠ¡ç«¯æ¸²æŸ“è€Œè¨€</strong></p><ul><li><strong>renderToString</strong>æ–¹æ³•æ¸²æŸ“çš„èŠ‚ç‚¹ä¼šå¸¦æœ‰data-react-idå±æ€§, åœ¨å‰ç«¯ react åŠ è½½å®Œæˆå, å‰ç«¯ react ä¼šè®¤è¯†ä¹‹å‰æœåŠ¡ç«¯æ¸²æŸ“çš„å†…å®¹, ä¸ä¼šé‡æ–°æ¸²æŸ“ DOM èŠ‚ç‚¹, å‰ç«¯ react ä¼šæ¥ç®¡é¡µé¢, æ‰§è¡Œ <code>componentDidMout</code> ç»‘å®šæµè§ˆå™¨äº‹ä»¶ç­‰ è¿™äº›åœ¨æœåŠ¡ç«¯æ²¡å®Œæˆä¹Ÿä¸å¯èƒ½æ‰§è¡Œä»»åŠ¡ã€‚</li><li><strong>renderToStaticMarkup</strong> æ¸²æŸ“å‡ºçš„æ˜¯ä¸å¸¦<code>data-react-id</code>çš„çº¯ html åœ¨å‰ç«¯ react åŠ è½½å®Œæˆå, ä¹‹å‰æœåŠ¡ç«¯æ¸²æŸ“çš„é¡µé¢ä¼šæŠ¹æ‰ä¹‹å‰æœåŠ¡ç«¯çš„é‡æ–°æ¸²æŸ“(å¯èƒ½é¡µé¢ä¼šé—ªä¸€ä¸‹). æ¢å¥è¯è¯´ <strong>å‰ç«¯reactå°±æ ¹æœ¬å°±ä¸è®¤è¯†ä¹‹å‰æœåŠ¡ç«¯æ¸²æŸ“çš„å†…å®¹</strong>, render æ–¹æ³•ä¼šä½¿ç”¨ innerHTML çš„æ–¹æ³•é‡å†™ #react-target é‡Œçš„å†…å®¹</li></ul><p>åœ¨packageæ·»åŠ å¯åŠ¨é…ç½®</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// package.json</span></span>
<span class="line"><span style="color:#98C379;">&quot;scripts&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#98C379;">    &quot;dev&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;npm-run-all --parallel dev:build:server dev:start&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">    &quot;dev:build:server&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;webpack --config config/webpack.server.js --watch&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">    &quot;dev:start&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;nodemon ./bundle/bundle.js&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>æ‰§è¡Œ yarn dev ,æ‰“å¼€ <a href="./.html">http://localhost:9999/ </a>é¡µé¢ç›´æ¥åœ¨æµè§ˆä¸Šæ˜¾ç¤ºï¼Œ åˆ°æ­¤ï¼Œå°±åˆæ­¥å®ç°äº†ä¸€ä¸ªReactç»„ä»¶æ˜¯æœåŠ¡ç«¯æ¸²æŸ“,åŠ å…¥ä½ åœ¨ç»„ä»¶Homeé‡Œé¢æ·»åŠ ä¸€äº›æ–¹æ³•æˆ–è€…è°ƒå–æ¥å£ï¼Œä½ ä¼šå‘ç°è¿™äº›éƒ½æ²¡æœ‰æ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦æ¥ä¸‹æ¥è¿›ä¸€æ­¥å®Œå–„ã€‚</p><h2 id="åŒæ„" tabindex="-1">åŒæ„ <a class="header-anchor" href="#åŒæ„" aria-label="Permalink to &quot;åŒæ„&quot;">â€‹</a></h2><p>è¦è§£å†³ä¸Šé¢ä¸Šé¢çš„é—®é¢˜ï¼Œå°±éœ€è¦åŒæ„äº†ï¼Œæ‰€è°“åŒæ„ï¼Œé€šä¿—çš„è®²ï¼Œå°±æ˜¯ä¸€å¥—Reactä»£ç åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œä¸€éï¼Œåˆ°æµè§ˆå™¨æ¸²æŸ“æ—¶åœ¨è¿è¡Œä¸€éï¼ŒæœåŠ¡ç«¯æ¸²æŸ“å®Œæˆé¡µé¢ç»“æ„ï¼Œæµè§ˆå™¨ç«¯æ¸²æŸ“å®Œæˆäº‹ä»¶ç»‘å®šæ¥å£è°ƒå–ï¼ˆé‡å¤åŠ è½½çš„jsæˆ–è€…csså®¢æˆ·ç«¯åè°ƒé˜¶æ®µæ—¶å€™ä¼šè¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœä¸€æ ·åˆ™ä¸æ¸²æŸ“äº†ï¼‰ã€‚</p><h3 id="å®¢æˆ·ç«¯é’ˆå¯¹è·¯ç”±æ‰“åŒ…js" tabindex="-1">å®¢æˆ·ç«¯é’ˆå¯¹è·¯ç”±æ‰“åŒ…JS <a class="header-anchor" href="#å®¢æˆ·ç«¯é’ˆå¯¹è·¯ç”±æ‰“åŒ…js" aria-label="Permalink to &quot;å®¢æˆ·ç«¯é’ˆå¯¹è·¯ç”±æ‰“åŒ…JS&quot;">â€‹</a></h3><p>æŠŠæ‰“åŒ…åçš„js,æ³¨å…¥åˆ°htmlä¸­ï¼Œè¿™æ ·åˆ°æµè§ˆå™¨å°±ä¼šå†æ¬¡è¯·æ±‚ï¼Œå°±å¯ä»¥å®Œæˆäº‹ä»¶ç»‘å®šç­‰è¡Œä¸ºæ“ä½œã€‚</p><p>æˆ‘ä»¬è¦ç”¨åˆ°react-domçš„<code>hydrate</code></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// client/index.js</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> React</span><span style="color:#ABB2BF;">, {</span><span style="color:#E06C75;">Component</span><span style="color:#ABB2BF;">} </span><span style="color:#C678DD;">from</span><span style="color:#98C379;"> &quot;react&quot;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> ReactDom</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &#39;react-dom&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> {</span><span style="color:#E06C75;">BrowserRouter</span><span style="color:#C678DD;"> as</span><span style="color:#E06C75;"> Router</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">Switch</span><span style="color:#ABB2BF;">} </span><span style="color:#C678DD;">from</span><span style="color:#98C379;"> &#39;react-router-dom&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> {</span><span style="color:#E06C75;">renderRoutes</span><span style="color:#ABB2BF;">} </span><span style="color:#C678DD;">from</span><span style="color:#98C379;"> &#39;react-router-config&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> Loadable</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &#39;react-loadable&#39;</span><span style="color:#ABB2BF;">; </span><span style="color:#7F848E;font-style:italic;">// è¿™é‡Œæ˜¯æˆ‘çš„ä¸€ä¸ªè·¯ç”±æ‹†åˆ†ï¼Œä½ ä»¬å¯ä»¥ä¸ç”¨</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> routes</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &#39;../router&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> App</span><span style="color:#C678DD;"> extends</span><span style="color:#E5C07B;"> Component</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">  render</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;</span><span style="color:#E5C07B;">Router</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E5C07B;">Switch</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#C678DD;">          {</span><span style="color:#61AFEF;">renderRoutes</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">routes</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">routes</span><span style="color:#ABB2BF;">)</span><span style="color:#C678DD;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;/</span><span style="color:#E5C07B;">Switch</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;/</span><span style="color:#E5C07B;">Router</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    )</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">Loadable</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">preloadReady</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">then</span><span style="color:#ABB2BF;">(() </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">  ReactDom</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">hydrate</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E5C07B;">App</span><span style="color:#ABB2BF;">/&gt;, </span><span style="color:#E5C07B;">document</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getElementById</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;root&#39;</span><span style="color:#ABB2BF;">));</span></span>
<span class="line"><span style="color:#ABB2BF;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>hydrate() æè¿°çš„æ˜¯ ReactDOM å¤ç”¨ ReactDOMServer æœåŠ¡ç«¯æ¸²æŸ“çš„å†…å®¹æ—¶å°½å¯èƒ½ä¿ç•™ç»“æ„ï¼Œå¹¶è¡¥å……äº‹ä»¶ç»‘å®šç­‰ Client ç‰¹æœ‰å†…å®¹çš„è¿‡ç¨‹</p><p>è¯´ç™½äº†<code>render()</code> æ ‡ç­¾ä¸Šæ²¡æœ‰å”¯ä¸€çš„å±æ€§ï¼Œä½†æ˜¯è¦å°½å¯èƒ½å¤ç”¨ ssr çš„ HTML ç»“æ„,æ‰€ä»¥å°±å‡ºç°äº†<code>hydrate()</code>,ä½†æ˜¯ç›®å‰ä¸¤è€…éƒ½æ˜¯å¯ä»¥ç”¨çš„ï¼Œ17ç‰ˆæœ¬<code>render()</code>å°±ä¸åœ¨æ”¯æŒ<code>ssr</code></p><p><a href="https://www.zhihu.com/question/66068748" target="_blank" rel="noreferrer">çŸ¥ä¹å¯¹ ReactDom.hydrate çš„è§£é‡Š</a></p><p>ç„¶åé…ç½®å®¢æˆ·ç«¯çš„webpackå°†å…¶ç¼–è¯‘æ‰“åŒ…æˆjsï¼Œåœ¨æœåŠ¡ç«¯htmlé‡Œé¢å¼•å…¥ã€‚</p><h3 id="å®¢æˆ·ç«¯-webpack-é…ç½®" tabindex="-1">å®¢æˆ·ç«¯ Webpack é…ç½® <a class="header-anchor" href="#å®¢æˆ·ç«¯-webpack-é…ç½®" aria-label="Permalink to &quot;å®¢æˆ·ç«¯ Webpack é…ç½®&quot;">â€‹</a></h3><p>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ‰“åŒ…åçš„è¾“å‡ºç›®å½•</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// config/outputPath </span></span>
<span class="line"><span style="color:#E5C07B;">module</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">exports</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;">  OUTPUTCLIENT</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;static&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">  OUTPUTSERVER</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;bundle&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// config/webpack.client.js</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> path</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;path&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> merge</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;webpack-merge&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> config</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;./webpack.base&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> {</span><span style="color:#E5C07B;">OUTPUTCLIENT</span><span style="color:#ABB2BF;">} </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;./outputPath&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> outputPath</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> \`../</span><span style="color:#C678DD;">\${</span><span style="color:#E5C07B;">OUTPUTCLIENT</span><span style="color:#C678DD;">}</span><span style="color:#98C379;">\`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> clientConfig</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;">  mode</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;development&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">  entry</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">path</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">resolve</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">__dirname</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;../client/index.js&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#E06C75;">  output</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">    filename</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;index.[chunkhash:8].js&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#7F848E;font-style:italic;">// è¿™é‡Œæˆ‘ç”¨çš„hashï¼Œç›®çš„æ˜¯é˜²æ­¢ç¼“å­˜</span></span>
<span class="line"><span style="color:#E06C75;">    path</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">path</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">resolve</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">__dirname</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">outputPath</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#E06C75;">    publicPath</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;/&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">  },</span></span>
<span class="line"><span style="color:#E06C75;">  module</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">    rules</span><span style="color:#ABB2BF;">: [</span></span>
<span class="line"><span style="color:#ABB2BF;">      {</span></span>
<span class="line"><span style="color:#E06C75;">        test</span><span style="color:#ABB2BF;">:</span><span style="color:#E06C75;"> /</span><span style="color:#56B6C2;">\\.</span><span style="color:#E06C75;">css</span><span style="color:#D19A66;">?</span><span style="color:#C678DD;">$</span><span style="color:#E06C75;">/</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">        use</span><span style="color:#ABB2BF;">: [</span><span style="color:#98C379;">&#39;style-loader&#39;</span><span style="color:#ABB2BF;">, {</span><span style="color:#7F848E;font-style:italic;">// è¿™é‡Œå»ºè®®ä½¿ç”¨style-loaderï¼Œå°‘é‡çš„cssç›´æ¥é‡‡ç”¨å®¢æˆ·ç«¯æ¸²æŸ“äº†</span></span>
<span class="line"><span style="color:#E06C75;">          loader</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;css-loader&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">          options</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">            modules</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">, </span><span style="color:#7F848E;font-style:italic;">// è¿™è¦è·ŸæœåŠ¡ç«¯ä¿æŒä¸€è‡´ï¼Œä¸ç„¶headé‡Œé¢æœ‰æ ·å¼ï¼Œå®¢æˆ·ç«¯æ²¡æœ‰å¯¹åº”çš„class</span></span>
<span class="line"><span style="color:#ABB2BF;">          }</span></span>
<span class="line"><span style="color:#ABB2BF;">        }]</span></span>
<span class="line"><span style="color:#ABB2BF;">      },</span></span>
<span class="line"><span style="color:#ABB2BF;">      {</span></span>
<span class="line"><span style="color:#E06C75;">        test</span><span style="color:#ABB2BF;">:</span><span style="color:#E06C75;"> /</span><span style="color:#56B6C2;">\\.</span><span style="color:#E06C75;">(png</span><span style="color:#ABB2BF;">|</span><span style="color:#E06C75;">jpeg</span><span style="color:#ABB2BF;">|</span><span style="color:#E06C75;">jpg</span><span style="color:#ABB2BF;">|</span><span style="color:#E06C75;">gif</span><span style="color:#ABB2BF;">|</span><span style="color:#E06C75;">svg)</span><span style="color:#D19A66;">?</span><span style="color:#C678DD;">$</span><span style="color:#E06C75;">/</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">        loader</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;url-loader&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">        options</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">          limit</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">8000</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">          outputPath</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">outputPath</span><span style="color:#ABB2BF;">, </span><span style="color:#7F848E;font-style:italic;">// è¾“å…¥è·¯å¾„</span></span>
<span class="line"><span style="color:#E06C75;">          publicPath</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;/&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">      }</span></span>
<span class="line"><span style="color:#ABB2BF;">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#E5C07B;">module</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">exports</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> merge</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">config</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">clientConfig</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>ç„¶ååœ¨ä¸Šé¢çš„<code>package.json</code>,é‡Œé¢æ·»åŠ <code> &quot;dev:build:client&quot;: &quot;webpack --config webpack.client.js --watch&quot;</code>ï¼Œå°±èƒ½å¯¹æµè§ˆå™¨ç”¨åˆ°çš„ä¸€äº›jså®Œæˆæ‰“åŒ…ã€‚</p><h3 id="æœåŠ¡ç«¯çš„è·¯ç”±é€»è¾‘" tabindex="-1">æœåŠ¡ç«¯çš„è·¯ç”±é€»è¾‘ <a class="header-anchor" href="#æœåŠ¡ç«¯çš„è·¯ç”±é€»è¾‘" aria-label="Permalink to &quot;æœåŠ¡ç«¯çš„è·¯ç”±é€»è¾‘&quot;">â€‹</a></h3><p>æœåŠ¡å™¨ç«¯è·¯ç”±ä»£ç ç›¸å¯¹è¦å¤æ‚ä¸€ç‚¹ï¼Œéœ€è¦ä½ æŠŠ <code>location</code>ï¼ˆå½“å‰è¯·æ±‚è·¯å¾„ï¼‰ä¼ é€’ç»™ <code>StaticRouter</code> ç»„ä»¶ï¼Œè¿™æ · <code>StaticRouter</code> æ‰èƒ½æ ¹æ®è·¯å¾„åˆ†æå‡ºå½“å‰æ‰€éœ€è¦çš„ç»„ä»¶æ˜¯è°ã€‚ï¼ˆPSï¼š<code>StaticRouter</code> æ˜¯ <code>React-Router</code>é’ˆå¯¹æœåŠ¡å™¨ç«¯æ¸²æŸ“ä¸“é—¨æä¾›çš„ä¸€ä¸ªè·¯ç”±ç»„ä»¶ã€‚ï¼‰</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// server/index.js</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> Koa</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &#39;koa&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> React</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &quot;react&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> Router</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &quot;koa-router&quot;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> {</span><span style="color:#E06C75;">renderToString</span><span style="color:#ABB2BF;">} </span><span style="color:#C678DD;">from</span><span style="color:#98C379;"> &#39;react-dom/server&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> {</span><span style="color:#E06C75;">StaticRouter</span><span style="color:#ABB2BF;">} </span><span style="color:#C678DD;">from</span><span style="color:#98C379;"> &#39;react-router-dom&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> Loadable</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &#39;react-loadable&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> routes</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &#39;@/router&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> {</span><span style="color:#E06C75;">renderRoutes</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">matchRoutes</span><span style="color:#ABB2BF;">} </span><span style="color:#C678DD;">from</span><span style="color:#98C379;"> &quot;react-router-config&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> {</span><span style="color:#E06C75;">renderHTML</span><span style="color:#ABB2BF;">} </span><span style="color:#C678DD;">from</span><span style="color:#98C379;"> &quot;./tem&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> app</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> Koa</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> route</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> Router</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">route</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">([</span><span style="color:#98C379;">&quot;/:route?&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> /</span><span style="color:#56B6C2;">\\/</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">[</span><span style="color:#E06C75;">\\w</span><span style="color:#D19A66;">|</span><span style="color:#E06C75;">\\d</span><span style="color:#D19A66;">]+</span><span style="color:#E06C75;">)</span><span style="color:#56B6C2;">\\/</span><span style="color:#E06C75;">.</span><span style="color:#D19A66;">*</span><span style="color:#E06C75;">/</span><span style="color:#ABB2BF;">], (</span><span style="color:#E06C75;font-style:italic;">ctx</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">  const</span><span style="color:#E5C07B;"> content</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> renderToString</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // é‡ç‚¹æ˜¯è¿™</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E5C07B;">StaticRouter</span><span style="color:#D19A66;font-style:italic;"> location</span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;">{</span><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">path</span><span style="color:#C678DD;">}</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#C678DD;">        {</span><span style="color:#61AFEF;">renderRoutes</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">routes</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">routes</span><span style="color:#ABB2BF;">)</span><span style="color:#C678DD;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E5C07B;">StaticRouter</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  );</span></span>
<span class="line"><span style="color:#E5C07B;">  ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">body</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> renderHTML</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">content</span><span style="color:#ABB2BF;">, {})</span></span>
<span class="line"><span style="color:#ABB2BF;">})</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// è¿™é‡Œè¦æ³¨æ„ä¸‹ä¸­é—´ä»¶çš„å…ˆåé¡ºåº</span></span>
<span class="line"><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">use</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;koa-static&#39;</span><span style="color:#ABB2BF;">)(</span><span style="color:#E5C07B;">process</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">cwd</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;/static&#39;</span><span style="color:#ABB2BF;">));</span></span>
<span class="line"><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">use</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">route</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">routes</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">use</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">route</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">allowedMethods</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">Loadable</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">preloadAll</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">then</span><span style="color:#ABB2BF;">(() </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">  const</span><span style="color:#E5C07B;"> server</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">listen</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;9999&#39;</span><span style="color:#ABB2BF;">, () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">    const</span><span style="color:#ABB2BF;"> {</span><span style="color:#E5C07B;">port</span><span style="color:#ABB2BF;">} </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> server</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">address</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">    console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">\`</span><span style="color:#56B6C2;">\\x1B</span><span style="color:#98C379;">[33m</span><span style="color:#56B6C2;">\\x1B</span><span style="color:#98C379;">[4mhttp://localhost:</span><span style="color:#C678DD;">\${</span><span style="color:#E06C75;">port</span><span style="color:#C678DD;">}</span><span style="color:#56B6C2;">\\x1B</span><span style="color:#98C379;">[0m\`</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">  })</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// server/tem.js</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> glob</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;glob&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">let</span><span style="color:#E06C75;"> project</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> glob</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">sync</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">process</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">cwd</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">+</span><span style="color:#98C379;"> &#39;/static/index.*.js&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">let</span><span style="color:#E06C75;"> path</span><span style="color:#56B6C2;"> =</span><span style="color:#E06C75;"> project</span><span style="color:#ABB2BF;">[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">export</span><span style="color:#C678DD;"> const</span><span style="color:#61AFEF;"> renderHTML</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">content</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">store</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#98C379;"> \`</span></span>
<span class="line"><span style="color:#98C379;">  &lt;!DOCTYPE html&gt;</span></span>
<span class="line"><span style="color:#98C379;">    &lt;html lang=&quot;zh&quot;&gt;</span></span>
<span class="line"><span style="color:#98C379;">      &lt;head&gt;</span></span>
<span class="line"><span style="color:#98C379;">        &lt;meta charset=&quot;utf-8&quot;&gt;</span></span>
<span class="line"><span style="color:#98C379;">        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no&quot; /&gt;</span></span>
<span class="line"><span style="color:#98C379;">        &lt;meta name=&quot;theme-color&quot; content=&quot;#000000&quot;&gt;</span></span>
<span class="line"><span style="color:#98C379;">        &lt;title&gt;ç¦¾å£å’Œssr&lt;/title&gt;</span></span>
<span class="line"><span style="color:#98C379;">      &lt;/head&gt;</span></span>
<span class="line"><span style="color:#98C379;">      &lt;body&gt;</span></span>
<span class="line"><span style="color:#98C379;">      &lt;div id=&quot;root&quot;&gt;</span><span style="color:#C678DD;">\${</span><span style="color:#E06C75;">content</span><span style="color:#C678DD;">}</span><span style="color:#98C379;">&lt;/div&gt;</span></span>
<span class="line"><span style="color:#98C379;">      &lt;script src=/</span><span style="color:#C678DD;">\${</span><span style="color:#E06C75;">path</span><span style="color:#ABB2BF;">[</span><span style="color:#E5C07B;">path</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">length</span><span style="color:#56B6C2;"> -</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">]</span><span style="color:#C678DD;">}</span><span style="color:#98C379;">&gt;&lt;/script&gt; // è¿™ä¸ª &#39;/&#39; ä¸€å®šè¦æ·»åŠ ï¼Œå‘äº†å¥½ä¹…</span></span>
<span class="line"><span style="color:#98C379;">      &lt;/body&gt;</span></span>
<span class="line"><span style="color:#98C379;">  &lt;/html&gt;</span></span>
<span class="line"><span style="color:#98C379;">\`</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="cssæ ·å¼é—®é¢˜å¤„ç†" tabindex="-1">CSSæ ·å¼é—®é¢˜å¤„ç† <a class="header-anchor" href="#cssæ ·å¼é—®é¢˜å¤„ç†" aria-label="Permalink to &quot;CSSæ ·å¼é—®é¢˜å¤„ç†&quot;">â€‹</a></h2><p>æ­£å¸¸çš„æœåŠ¡ç«¯æ¸²æŸ“åªæ˜¯è¿”å›äº† HTML å­—ç¬¦ä¸²ï¼Œæ ·å¼éœ€è¦æµè§ˆå™¨åŠ è½½å®Œ CSS åæ‰ä¼šåŠ ä¸Šï¼Œè¿™ä¸ªæ ·å¼æ·»åŠ çš„è¿‡ç¨‹å°±<code>ä¼šé€ æˆé¡µé¢çš„é—ªåŠ¨</code>ï¼Œæ‰€ä»¥åœ¨æœåŠ¡ç«¯é‡Œé¢ç›´æ¥æ·»åŠ éœ€è¦å¼•ç”¨çš„CSSã€‚</p><p>æˆ‘ä»¬ä¸èƒ½å†ä½¿ç”¨ style-loader äº†ï¼Œå› ä¸ºè¿™ä¸ª webpack loader ä¼šåœ¨ç¼–è¯‘æ—¶å°†æ ·å¼æ¨¡å—è½½å…¥åˆ° HTML header ä¸­ã€‚ä½†æ˜¯åœ¨æœåŠ¡ç«¯æ¸²æŸ“ç¯å¢ƒä¸‹ï¼Œæ²¡æœ‰ window å¯¹è±¡ï¼Œstyle-loader è¿›è€Œä¼šæŠ¥é”™ã€‚ä¸€èˆ¬æˆ‘ä»¬æ¢ç”¨ <code>isomorphic-style-loader</code> ,åŒæ—¶ <code>isomorphic-style-loader </code>ä¹Ÿä¼šè§£å†³é¡µé¢æ ·å¼é—ªåŠ¨çš„é—®é¢˜ï¼Œå®ƒçš„åŸç†ä¹Ÿä¸éš¾ç†è§£ï¼š<code>isomorphic-style-loader </code>åˆ©ç”¨ context APIï¼Œåœ¨æ¸²æŸ“é¡µé¢ç»„ä»¶æ—¶è·å–æ‰€æœ‰ React ç»„ä»¶çš„æ ·å¼ä¿¡æ¯ï¼Œåœ¨æœåŠ¡å™¨ç«¯è¾“å‡º html å­—ç¬¦ä¸²çš„åŒæ—¶ï¼Œä¹Ÿå°†æ ·å¼æ’å…¥åˆ° html å­—ç¬¦ä¸²å½“ä¸­ï¼Œå°†ç»“æœä¸€åŒä¼ é€åˆ°å®¢æˆ·ç«¯ã€‚</p><p>å› ä¸ºæˆ‘ä»¬å·²ç»å¼€å¯äº†cssmodulesï¼Œæ‰€ä»¥ç›´æ¥å¯¼å…¥åˆ°headé‡Œé¢æ˜¯ä¸ä¼šå­˜åœ¨æ ·å¼å†²çªçš„é—®é¢˜ã€‚<code>isomorphic-style-loader </code>å·²ç»ç»™æˆ‘ä»¬æä¾›äº†ä¸€äº›å¯¼å…¥css çš„ é«˜é˜¶å‡½æ•° <code>withsSyles</code></p><p>å’Œ hooks <code>useStyles</code>ï¼Œç”¨çš„æ—¶å€™æ¯”è¾ƒçœäº‹ã€‚</p><p><strong>çœ‹ä¸‹ä»£ç é…ç½®</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// config/webpack.client.js</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">  test</span><span style="color:#ABB2BF;">: [</span><span style="color:#E06C75;">/</span><span style="color:#56B6C2;">\\.</span><span style="color:#E06C75;">css</span><span style="color:#ABB2BF;">|</span><span style="color:#E06C75;">less</span><span style="color:#C678DD;">$</span><span style="color:#E06C75;">/</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#E06C75;">    use</span><span style="color:#ABB2BF;">: [</span></span>
<span class="line"><span style="color:#98C379;">      &#39;style-loader&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#7F848E;font-style:italic;">// ä¹Ÿå¯ä»¥è·ŸæœåŠ¡ç«¯çš„ä¸€æ ·ï¼Œå°±æ˜¯éº»çƒ¦ç‚¹ï¼Œæ¯æ¬¡ä½¿ç”¨css,éƒ½éœ€è¦é¢å¤–çš„æ‰‹ç»­</span></span>
<span class="line"><span style="color:#ABB2BF;">      {</span></span>
<span class="line"><span style="color:#E06C75;">        loader</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;css-loader&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">        options</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">          modules</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">      },</span></span>
<span class="line"><span style="color:#98C379;">      &#39;less-loader&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// config/webpack.server.js</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">  test</span><span style="color:#ABB2BF;">: [</span><span style="color:#E06C75;">/</span><span style="color:#56B6C2;">\\.</span><span style="color:#E06C75;">css</span><span style="color:#ABB2BF;">|</span><span style="color:#E06C75;">less</span><span style="color:#C678DD;">$</span><span style="color:#E06C75;">/</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#E06C75;">    use</span><span style="color:#ABB2BF;">: [</span></span>
<span class="line"><span style="color:#98C379;">      &#39;isomorphic-style-loader&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">      {</span></span>
<span class="line"><span style="color:#E06C75;">        loader</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;css-loader&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">        options</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">          modules</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">      },</span></span>
<span class="line"><span style="color:#98C379;">      &#39;less-loader&#39;</span><span style="color:#7F848E;font-style:italic;">  // å¿…é¡»é…ç½® ä¸ç„¶ä¼šå½“æˆcss,è§†è§‰å¯èƒ½çœ‹ä¸å‡ºæ¥ï¼Œå› ä¸ºå®¢æˆ·ç«¯é…ç½®äº†less</span></span>
<span class="line"><span style="color:#ABB2BF;">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>æœåŠ¡ç«¯é¦–é¡µ</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// server/index.js </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">//  ...</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> css</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> Set</span><span style="color:#ABB2BF;">() </span><span style="color:#7F848E;font-style:italic;">// è¿™ä¸ªå¿…é¡»åœ¨è·¯ç”±å‡½æ•°é‡Œé¢ï¼Œåœ¨å¤–é¢çš„è¯ï¼Œå°±ä¼šç´¯åŠ å‡ºç°ä¹‹å‰çš„css</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#61AFEF;"> insertCss</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> (...</span><span style="color:#E06C75;font-style:italic;">styles</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#E5C07B;"> styles</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">forEach</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">style</span><span style="color:#C678DD;"> =&gt;</span><span style="color:#E5C07B;"> css</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">add</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">style</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">_getCss</span><span style="color:#ABB2BF;">()));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> content</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> renderToString</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;</span><span style="color:#E5C07B;">StaticRouter</span><span style="color:#D19A66;font-style:italic;"> location</span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;">{</span><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">path</span><span style="color:#C678DD;">}</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E5C07B;">StyleContext.Provider</span><span style="color:#D19A66;font-style:italic;"> value</span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;">{</span><span style="color:#ABB2BF;">{</span><span style="color:#E06C75;">insertCss</span><span style="color:#ABB2BF;">}</span><span style="color:#C678DD;">}</span><span style="color:#ABB2BF;">&gt; </span></span>
<span class="line"><span style="color:#C678DD;">           {</span><span style="color:#61AFEF;">renderRoutes</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">routes</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">routes</span><span style="color:#ABB2BF;">)</span><span style="color:#C678DD;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;/</span><span style="color:#E5C07B;">StyleContext.Provider</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">   &lt;/</span><span style="color:#E5C07B;">StaticRouter</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">body</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> renderHTML</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">content</span><span style="color:#ABB2BF;">, {}, </span><span style="color:#E06C75;">css</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// ....</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>å®¢æˆ·ç«¯ä¹Ÿéœ€è¦é…ç½®</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// client/index.js</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> React</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &quot;react&quot;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> ReactDom</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &#39;react-dom&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> {</span><span style="color:#E06C75;">BrowserRouter</span><span style="color:#C678DD;"> as</span><span style="color:#E06C75;"> Router</span><span style="color:#ABB2BF;">} </span><span style="color:#C678DD;">from</span><span style="color:#98C379;"> &#39;react-router-dom&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> {</span><span style="color:#E06C75;">renderRoutes</span><span style="color:#ABB2BF;">} </span><span style="color:#C678DD;">from</span><span style="color:#98C379;"> &#39;react-router-config&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> Loadable</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &#39;react-loadable&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> StyleContext</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &#39;isomorphic-style-loader/StyleContext&#39;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> routes</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &#39;../router&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#61AFEF;"> insertCss</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> (...</span><span style="color:#E06C75;font-style:italic;">styles</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">  const</span><span style="color:#E5C07B;"> removeCss</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> styles</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">map</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">style</span><span style="color:#C678DD;"> =&gt;</span><span style="color:#E5C07B;"> style</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">_insertCss</span><span style="color:#56B6C2;"> &amp;&amp;</span><span style="color:#E5C07B;"> style</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">_insertCss</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#C678DD;">  return</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#E5C07B;"> removeCss</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">forEach</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">dispose</span><span style="color:#C678DD;"> =&gt;</span><span style="color:#E06C75;"> dispose</span><span style="color:#56B6C2;"> &amp;&amp;</span><span style="color:#61AFEF;"> dispose</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#61AFEF;"> App</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">  return</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E5C07B;">Router</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#C678DD;">        {</span><span style="color:#61AFEF;">renderRoutes</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">routes</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">routes</span><span style="color:#ABB2BF;">)</span><span style="color:#C678DD;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E5C07B;">Router</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  )</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">Loadable</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">preloadReady</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">then</span><span style="color:#ABB2BF;">(() </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">  ReactDom</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">hydrate</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E5C07B;">StyleContext.Provider</span><span style="color:#D19A66;font-style:italic;"> value</span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;">{</span><span style="color:#ABB2BF;">{</span><span style="color:#E06C75;">insertCss</span><span style="color:#ABB2BF;">}</span><span style="color:#C678DD;">}</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;</span><span style="color:#E5C07B;">App</span><span style="color:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E5C07B;">StyleContext.Provider</span><span style="color:#ABB2BF;">&gt;, </span><span style="color:#E5C07B;">document</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getElementById</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;root&#39;</span><span style="color:#ABB2BF;">));</span></span>
<span class="line"><span style="color:#ABB2BF;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>è¿™æ ·æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨<code>isomorphic-style-loader</code>çš„ä¸€äº›API, <strong>æœ‰äº›<code>ä¸é‡è¦</code>çš„é¡µé¢ï¼Œæˆ–è€…ä¸é‡è¦çš„csså¯ä»¥ç›´æ¥é‡‡ç”¨å®¢æˆ·ç«¯æ¸²æŸ“</strong>,å°±ä¸éœ€è¦å¼•å…¥é«˜é˜¶å‡½æ•°æˆ–è€…useStylesã€‚</p><p>åœ¨é¡µé¢å†…å…·ä½“ä½¿ç”¨</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// å‡½æ•°å¼ç»„ä»¶</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> useStyles</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &#39;isomorphic-style-loader/useStyles&#39;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> styles</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &quot;./index.css&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#61AFEF;"> Index</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">props</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">  useStyles</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">styles</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// ç±»ç»„ä»¶ä½¿ç”¨</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> withStyles</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &#39;isomorphic-style-loader/withStyles&#39;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> styles</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &quot;./index.css&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#61AFEF;">withStyles</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">styles</span><span style="color:#ABB2BF;">) </span><span style="color:#7F848E;font-style:italic;">// éœ€è¦åœ¨baseé‡Œé¢é¢å¤–é…ç½®</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> Index</span><span style="color:#C678DD;"> extends</span><span style="color:#E5C07B;"> React</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Component</span><span style="color:#ABB2BF;"> {}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// ä½¿ç”¨å®¢æˆ·ç«¯æ¸²æŸ“</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> styles</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &quot;./index.css&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#61AFEF;"> Index</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  // è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨useStyles éƒ¨åˆ†ä½¿ç”¨å®¢æˆ·ç«¯æ¸²æŸ“</span></span>
<span class="line"><span style="color:#C678DD;">  return</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">div</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;</span><span style="color:#E06C75;">h1</span><span style="color:#D19A66;font-style:italic;"> className</span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;">{</span><span style="color:#E06C75;">styles</span><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&#39;title-center&#39;</span><span style="color:#ABB2BF;">]</span><span style="color:#C678DD;">}</span><span style="color:#ABB2BF;">&gt;message&lt;/</span><span style="color:#E06C75;">h1</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;</span><span style="color:#E06C75;">h1</span><span style="color:#D19A66;font-style:italic;"> className</span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;">{</span><span style="color:#98C379;">&#39;title-center&#39;</span><span style="color:#C678DD;">}</span><span style="color:#ABB2BF;">&gt;message&lt;/</span><span style="color:#E06C75;">h1</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;">div</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  )</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>ç„¶åæ‰“å¼€ç½‘é¡µçš„æºä»£ç å°±å¯ä»¥çœ‹è§headé‡Œé¢å·²ç»æœ‰æˆ‘ä»¬éœ€è¦çš„cssäº†ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2020/7/23/1737b44ea25a4b63?w=1251&amp;h=881&amp;f=png&amp;s=177846" alt="image-20200702185101916"></p><h2 id="ssrä¸­å¼‚æ­¥æ•°æ®çš„è·å–-dvaçš„ä½¿ç”¨" tabindex="-1">SSRä¸­å¼‚æ­¥æ•°æ®çš„è·å– + Dvaçš„ä½¿ç”¨ <a class="header-anchor" href="#ssrä¸­å¼‚æ­¥æ•°æ®çš„è·å–-dvaçš„ä½¿ç”¨" aria-label="Permalink to &quot;SSRä¸­å¼‚æ­¥æ•°æ®çš„è·å– + Dvaçš„ä½¿ç”¨&quot;">â€‹</a></h2><h3 id="dvaçš„ä½¿ç”¨" tabindex="-1">Dvaçš„ä½¿ç”¨ <a class="header-anchor" href="#dvaçš„ä½¿ç”¨" aria-label="Permalink to &quot;Dvaçš„ä½¿ç”¨&quot;">â€‹</a></h3><p>ä¹‹å‰é¡¹ç›®ä¸€ç›´ç”¨çš„dvaï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨çš„dva-coreä»£æ›¿çš„reduxï¼Œä¸ä¼šé…ç½®çš„è‡ªè¡ŒæŸ¥ä¸‹æ–‡æ¡£ã€‚</p><p>åˆ›å»º <code>Store</code>ï¼šè¿™ä¸€éƒ¨åˆ†æœ‰å‘ï¼Œè¦æ³¨æ„é¿å…ï¼Œå¤§å®¶çŸ¥é“ï¼Œåœ¨å®¢æˆ·ç«¯æ¸²æŸ“ä¸­ï¼Œç”¨æˆ·çš„æµè§ˆå™¨ä¸­æ°¸è¿œåªå­˜åœ¨ä¸€ä¸ª <code>Store</code>ï¼Œæ‰€ä»¥ä»£ç ä¸Šä½ å¯ä»¥è¿™ä¹ˆå†™</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> dvaApp</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> createApp</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#E06C75;">  initialState</span><span style="color:#ABB2BF;">: {},</span></span>
<span class="line"><span style="color:#E06C75;">  models</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">models</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> store</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> dvaApp</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getStore</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;">export</span><span style="color:#C678DD;"> default</span><span style="color:#E06C75;"> store</span><span style="color:#ABB2BF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>ç„¶è€Œåœ¨æœåŠ¡å™¨ç«¯ï¼Œè¿™ä¹ˆå†™å°±æœ‰é—®é¢˜äº†ï¼Œå› ä¸ºæœåŠ¡å™¨ç«¯çš„ <code>Store</code> æ˜¯æ‰€æœ‰ç”¨æˆ·éƒ½è¦ç”¨çš„ï¼Œå¦‚æœåƒä¸Šé¢è¿™æ ·æ„å»º <code>Store</code>ï¼Œ<code>Store</code> å˜æˆäº†ä¸€ä¸ªå•ä¾‹ï¼Œæ‰€æœ‰ç”¨æˆ·å…±äº« <code>Store</code>ï¼Œæ˜¾ç„¶å°±æœ‰é—®é¢˜äº†ã€‚æ‰€ä»¥åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ä¸­ï¼Œ<code>Store</code> çš„åˆ›å»ºåº”è¯¥iåƒä¸‹é¢è¿™æ ·ï¼Œè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œæ¯ä¸ªç”¨æˆ·è®¿é—®çš„æ—¶å€™ï¼Œè¿™ä¸ªå‡½æ•°é‡æ–°æ‰§è¡Œï¼Œä¸ºæ¯ä¸ªç”¨æˆ·æä¾›ä¸€ä¸ªç‹¬ç«‹çš„ <code>Store</code></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> dvaApp</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> createApp</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#E06C75;">  initialState</span><span style="color:#ABB2BF;">: {},</span></span>
<span class="line"><span style="color:#E06C75;">  models</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">models</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">export</span><span style="color:#C678DD;"> const</span><span style="color:#61AFEF;"> getStore</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;">  () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">  return</span><span style="color:#E5C07B;"> dvaApp</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getStore</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>åˆ«æ…Œï¼Œä½ å¦‚æœè¿™æ ·çš„åšçš„è¯ï¼Œreduxçš„æ•°æ®è¿˜æ˜¯æ‰€æœ‰å®¢æˆ·åŒæ­¥å…¬ç”¨ï¼Œå› ä¸ºä½ çš„modelæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ˜¯é™æ€å¯¼å…¥ï¼Œè¿™ä¸ªæ—¶å€™ä½ åº”è¯¥æŠŠmodelå†™æˆå‡½æ•°çš„å½¢å¼ï¼Œè¿™æ ·åå°æ¯æ¬¡éƒ½èƒ½è·å–åˆ°æœ€æ–°çš„æ•°æ®</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">const</span><span style="color:#61AFEF;"> menuTree</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">  return</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;">    namespace</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;menuTree&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">    state</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">      routes</span><span style="color:#ABB2BF;">: []</span></span>
<span class="line"><span style="color:#ABB2BF;">    },</span></span>
<span class="line"><span style="color:#E06C75;">    effects</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#C678DD;">      *</span><span style="color:#61AFEF;"> reset</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">payload</span><span style="color:#ABB2BF;">, {</span><span style="color:#E06C75;font-style:italic;">call</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">put</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">select</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">update</span><span style="color:#ABB2BF;">}) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">         // .........</span></span>
<span class="line"><span style="color:#ABB2BF;">      },</span></span>
<span class="line"><span style="color:#ABB2BF;">    },</span></span>
<span class="line"><span style="color:#E06C75;">    reducers</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#61AFEF;">      save</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">state</span><span style="color:#ABB2BF;">, {</span><span style="color:#E06C75;font-style:italic;">payload</span><span style="color:#ABB2BF;">}) {</span></span>
<span class="line"><span style="color:#C678DD;">        return</span><span style="color:#ABB2BF;"> {...</span><span style="color:#E06C75;">state</span><span style="color:#ABB2BF;">, ...</span><span style="color:#E06C75;">payload</span><span style="color:#ABB2BF;">};</span></span>
<span class="line"><span style="color:#ABB2BF;">      },</span></span>
<span class="line"><span style="color:#ABB2BF;">    },</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"><span style="color:#C678DD;">export</span><span style="color:#C678DD;"> default</span><span style="color:#E06C75;"> menuTree</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>æ¢æˆå‡½æ•°çš„å¯¼å‡ºå½¢å¼å°±OKäº†ï¼Œç„¶ååœ¨createAppçš„æ–¹æ³•ï¼ŒåŸæœ‰çš„<code>models.forEach(model =&gt; app.model(model);</code>è½¬æ¢æˆ <code>models.forEach(model =&gt; app.model(model()));</code> å°±OKäº†ã€‚</p><h3 id="æ•°æ®è·å–" tabindex="-1">æ•°æ®è·å– <a class="header-anchor" href="#æ•°æ®è·å–" aria-label="Permalink to &quot;æ•°æ®è·å–&quot;">â€‹</a></h3><p>æ•°æ®è·å–çš„è§£å†³æ–¹æ¡ˆæ˜¯é…ç½®è·¯ç”± route-router-configï¼Œç»“åˆ <code>matchRoutes</code>ï¼Œæ‰¾åˆ°é¡µé¢ä¸Šç›¸å…³ç»„ä»¶æ‰€éœ€çš„è¯·æ±‚æ¥å£çš„æ–¹æ³•å¹¶æ‰§è¡Œè¯·æ±‚ï¼Œè¿™å°±è¦æ±‚å¼€å‘è€…é€šè¿‡è·¯ç”±é…ç½®ä¿¡æ¯ï¼Œæ˜¾å¼åœ°å‘ŠçŸ¥æœåŠ¡ç«¯è¯·æ±‚å†…å®¹ã€‚</p><p><strong>å®¢æˆ·ç«¯è·¯ç”±æ”¹é€ </strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// router/index.js</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">  path</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;/login&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">  exact</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">  component</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">Login</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">  loadData</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">Login</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">loadData</span><span style="color:#ABB2BF;">, </span><span style="color:#7F848E;font-style:italic;">// è¿™é‡Œå°±æ˜¯è¯·æ±‚æ•°æ®çš„æ–¹æ³•</span></span>
<span class="line"><span style="color:#E06C75;">  title</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;ç™»å½•é¡µ&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// å®¢æˆ·ç«¯ç»„ä»¶ä½¿ç”¨</span></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> Index</span><span style="color:#C678DD;"> extends</span><span style="color:#E5C07B;"> Component</span><span style="color:#ABB2BF;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">Index</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">loadData</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> async</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">store</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">  store</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">dispatch</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#E06C75;">    type</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;menuTree/reset&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">  });</span></span>
<span class="line"><span style="color:#E5C07B;">  console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;æˆ‘è¯•è¯•è¿™ä¸ªåˆ°åº•åŠ è½½ä¸&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#C678DD;">export</span><span style="color:#C678DD;"> default</span><span style="color:#E06C75;"> Index</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>æœåŠ¡ç«¯ä»£ç </strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// server/index.js</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// è·å–è¯·æ±‚çš„æ–¹æ³•</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> promises</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">matchedRoutes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">forEach</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">item</span><span style="color:#C678DD;"> =&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">  if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">item</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">route</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">loadData</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#C678DD;">    const</span><span style="color:#E5C07B;"> promise</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> new</span><span style="color:#E5C07B;"> Promise</span><span style="color:#ABB2BF;">((</span><span style="color:#E06C75;font-style:italic;">resolve</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">reject</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">      // è¿™é‡Œç”¨äº†.then æ‰€ä»¥ç»„ä»¶é‡Œé¢å¿…é¡»ä½¿ç”¨asyncæˆ–è€…promise</span></span>
<span class="line"><span style="color:#E5C07B;">      item</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">route</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">loadData</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">store</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">then</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">resolve</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">catch</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">reject</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    })</span></span>
<span class="line"><span style="color:#E5C07B;">    promises</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">push</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">promise</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// è¿™é‡Œè¦æ³¨æ„çš„ä¸€ä¸ªé—®é¢˜ï¼Œä½ çš„æ–¹æ³•å¯èƒ½æ˜¯å¼‚æ­¥çš„ï¼Œä¼šå‡ºç° ctx.body æ²¡æœ‰æ‰§è¡Œçš„é—®é¢˜ï¼Œæ‰€ä»¥è¦æŠŠè¿™ä¸ªä¸­é—´ä»¶è®¾ç½®ä¸ºå¼‚æ­¥çš„</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// ä¸ºäº†ç¡®ä¿ç»„ä»¶çš„loadDataçš„æ–¹æ³•æ‰§è¡Œå®Œæ¯•</span></span>
<span class="line"><span style="color:#C678DD;">await</span><span style="color:#E5C07B;"> Promise</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">all</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">promises</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">then</span><span style="color:#ABB2BF;">(() </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">  const</span><span style="color:#E5C07B;"> css</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> Set</span><span style="color:#ABB2BF;">(); </span><span style="color:#7F848E;font-style:italic;">// é˜²æ­¢é’©å­å‡½æ•°æ‰§è¡Œä¸¤æ¬¡</span></span>
<span class="line"><span style="color:#C678DD;">  const</span><span style="color:#61AFEF;"> insertCss</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> (...</span><span style="color:#E06C75;font-style:italic;">styles</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#E5C07B;"> styles</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">forEach</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">style</span><span style="color:#C678DD;"> =&gt;</span><span style="color:#E5C07B;"> css</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">add</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">style</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">_getCss</span><span style="color:#ABB2BF;">()));</span></span>
<span class="line"><span style="color:#C678DD;">  const</span><span style="color:#E5C07B;"> helmet</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> Helmet</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">renderStatic</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;">  const</span><span style="color:#E5C07B;"> content</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> renderToString</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E5C07B;">Provider</span><span style="color:#D19A66;font-style:italic;"> store</span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;">{</span><span style="color:#E06C75;">store</span><span style="color:#C678DD;">}</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E5C07B;">StaticRouter</span><span style="color:#D19A66;font-style:italic;"> location</span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;">{</span><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">path</span><span style="color:#C678DD;">}</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">          &lt;</span><span style="color:#E5C07B;">StyleContext.Provider</span><span style="color:#D19A66;font-style:italic;"> value</span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;">{</span><span style="color:#ABB2BF;">{</span><span style="color:#E06C75;">insertCss</span><span style="color:#ABB2BF;">}</span><span style="color:#C678DD;">}</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#C678DD;">            {</span><span style="color:#61AFEF;">renderRoutes</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">routes</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">routes</span><span style="color:#ABB2BF;">)</span><span style="color:#C678DD;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">          &lt;/</span><span style="color:#E5C07B;">StyleContext.Provider</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;/</span><span style="color:#E5C07B;">StaticRouter</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;/</span><span style="color:#E5C07B;">Provider</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">     )</span></span>
<span class="line"><span style="color:#E5C07B;">     ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">body</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> renderHTML</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">content</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">store</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">css</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">helmet</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="æ³¨æ°´å’Œè„±æ°´" tabindex="-1">æ³¨æ°´å’Œè„±æ°´ <a class="header-anchor" href="#æ³¨æ°´å’Œè„±æ°´" aria-label="Permalink to &quot;æ³¨æ°´å’Œè„±æ°´&quot;">â€‹</a></h3><p><strong>æ¶‰åŠåˆ°æ•°æ®çš„é¢„è·å–ï¼Œä¹Ÿæ˜¯æœåŠ¡ç«¯æ¸²æŸ“çš„çœŸæ­£æ„ä¹‰ã€‚</strong></p><p>ä¸Šé¢çš„ä»£ç æ­£å¸¸è¿è¡Œæ˜¯æ²¡é—®é¢˜äº†ï¼Œä½†æ˜¯å‘ç°å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„storeï¼Œå­˜åœ¨ä¸åŒæ­¥çš„é—®é¢˜ã€‚</p><p>å…¶å®ä¹Ÿå¾ˆå¥½ç†è§£ã€‚å½“æœåŠ¡ç«¯æ‹¿åˆ°storeå¹¶è·å–æ•°æ®åï¼Œå®¢æˆ·ç«¯çš„jsä»£ç åˆæ‰§è¡Œä¸€éï¼Œåœ¨å®¢æˆ·ç«¯ä»£ç æ‰§è¡Œçš„æ—¶å€™åˆåˆ›å»ºäº†ä¸€ä¸ªç©ºçš„storeï¼Œä¸¤ä¸ªstoreçš„æ•°æ®ä¸èƒ½åŒæ­¥ã€‚</p><p>æ‰€ä»¥ åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“æ—¶ï¼Œé¦–å…ˆæœåŠ¡ç«¯è¯·æ±‚æ¥å£æ‹¿åˆ°æ•°æ®ï¼Œå¹¶å¤„ç†å‡†å¤‡å¥½æ•°æ®çŠ¶æ€ï¼ˆå¦‚æœä½¿ç”¨ Reduxï¼Œå°±æ˜¯è¿›è¡Œ store çš„æ›´æ–°ï¼‰ï¼Œä¸ºäº†å‡å°‘å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œæˆ‘ä»¬éœ€è¦ä¿ç•™ä½è¿™ä¸ªçŠ¶æ€ã€‚ä¸€èˆ¬åšæ³•æ˜¯åœ¨æœåŠ¡å™¨ç«¯è¿”å› HTML å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œå°†æ•°æ® JSON.stringify ä¸€å¹¶è¿”å›ï¼Œè¿™ä¸ªè¿‡ç¨‹ï¼Œå«åšæ³¨æ°´ï¼›åœ¨å®¢æˆ·ç«¯ï¼Œå°±ä¸å†éœ€è¦è¿›è¡Œæ•°æ®çš„è¯·æ±‚äº†ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æœåŠ¡ç«¯ä¸‹å‘ä¸‹æ¥çš„æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹å«è„±æ°´ã€‚</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">script</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">   window.context = </span><span style="color:#C678DD;">{</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">   // è¿™é‡Œæ˜¯æ³¨æ°´</span></span>
<span class="line"><span style="color:#E06C75;">   state</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">$</span><span style="color:#ABB2BF;">{</span><span style="color:#61AFEF;">serialize</span><span style="color:#ABB2BF;">(store.getState())}  </span><span style="color:#7F848E;font-style:italic;">// serialize æ˜¯ä¸ºäº†é˜²æ­¢xssçš„æ”»å‡»</span></span>
<span class="line"><span style="color:#C678DD;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">script</span><span style="color:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> {</span><span style="color:#E06C75;">create</span><span style="color:#ABB2BF;">} </span><span style="color:#C678DD;">from</span><span style="color:#98C379;"> &#39;dva-core&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">function</span><span style="color:#61AFEF;"> createApp</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">opt</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  // .....</span></span>
<span class="line"><span style="color:#C678DD;">  return</span><span style="color:#E06C75;"> app</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// æœåŠ¡ç«¯çš„redux</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> dvaApp</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> createApp</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#E06C75;">  initialState</span><span style="color:#ABB2BF;">: {},</span></span>
<span class="line"><span style="color:#E06C75;">  models</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">models</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span>
<span class="line"><span style="color:#C678DD;">export</span><span style="color:#C678DD;"> const</span><span style="color:#61AFEF;"> getStore</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">  return</span><span style="color:#E5C07B;"> dvaApp</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getStore</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// å®¢æˆ·ç«¯çš„redux</span></span>
<span class="line"><span style="color:#C678DD;">export</span><span style="color:#C678DD;"> const</span><span style="color:#61AFEF;"> getClientStore</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  // éœ€è¦å…ˆæ‹¿åˆ°æœåŠ¡ç«¯çš„æ•°æ®, è„±æ°´</span></span>
<span class="line"><span style="color:#C678DD;">  const</span><span style="color:#E5C07B;"> initialState</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> window</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">context</span><span style="color:#C678DD;"> ?</span><span style="color:#E5C07B;"> window</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">context</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">state</span><span style="color:#C678DD;"> :</span><span style="color:#ABB2BF;"> {};</span></span>
<span class="line"><span style="color:#C678DD;">  const</span><span style="color:#E5C07B;"> dvaClientApp</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> createApp</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#E06C75;">    initialState</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">    models</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">models</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">  return</span><span style="color:#E5C07B;"> dvaClientApp</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getStore</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="é…ç½®ä»£ç†" tabindex="-1">é…ç½®ä»£ç† <a class="header-anchor" href="#é…ç½®ä»£ç†" aria-label="Permalink to &quot;é…ç½®ä»£ç†&quot;">â€‹</a></h3><p>æœåŠ¡ç«¯æ˜¯æ²¡æœ‰åŸŸçš„å­˜åœ¨ï¼Œæ‰€ä»¥ä¸ä¼šå­˜åœ¨è·¨åŸŸçš„é—®é¢˜ï¼Œä½†æ˜¯åœ¨å®¢æˆ·ç«¯è°ƒå–æ¥å£è¿˜å­˜åœ¨è·¨åŸŸçš„é—®é¢˜ï¼Œæ‰€ä»¥è¿˜éœ€è¦é…ç½®ä¸‹ä»£ç†ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> httpProxy</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &#39;http-proxy-middleware&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> k2c</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &quot;koa2-connect&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// è½¬å‘ä»£ç†</span></span>
<span class="line"><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">use</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">ctx</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">next</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">  if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">url</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">startsWith</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/api&#39;</span><span style="color:#ABB2BF;">)) { </span><span style="color:#7F848E;font-style:italic;">//åŒ¹é…æœ‰apiå­—æ®µçš„è¯·æ±‚url</span></span>
<span class="line"><span style="color:#E5C07B;">    ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">respond</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> false</span><span style="color:#7F848E;font-style:italic;"> // ç»•è¿‡koaå†…ç½®å¯¹è±¡response ï¼Œå†™å…¥åŸå§‹reså¯¹è±¡ï¼Œè€Œä¸æ˜¯koaå¤„ç†è¿‡çš„response</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#61AFEF;"> k2c</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">httpProxy</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#E06C75;">        target</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;https://api.xxxxx.xxx&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">        changeOrigin</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">        secure</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">false</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">        pathRewrite</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#98C379;">          &#39;^/api&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">      }</span></span>
<span class="line"><span style="color:#ABB2BF;">    ))(</span><span style="color:#E06C75;">ctx</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">next</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#C678DD;">  await</span><span style="color:#61AFEF;"> next</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>è¿˜å¯ä»¥å®‰è£…koaçš„ä»£ç†æ¨¡å— <code>koa2-proxy-middleware</code>,ç”¨æ³•å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> proxy</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;koa2-proxy-middleware&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> options</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;">  targets</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#98C379;">    &#39;/user&#39;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">      // this is option of http-proxy-middleware</span></span>
<span class="line"><span style="color:#E06C75;">      target</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;http://localhost:3001&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#7F848E;font-style:italic;">// target host</span></span>
<span class="line"><span style="color:#E06C75;">      changeOrigin</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">, </span><span style="color:#7F848E;font-style:italic;">// needed for virtual hosted sites</span></span>
<span class="line"><span style="color:#ABB2BF;">    },</span></span>
<span class="line"><span style="color:#98C379;">    &#39;/user/:id&#39;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">      target</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;http://localhost:3001&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">      changeOrigin</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    },</span></span>
<span class="line"><span style="color:#98C379;">    &#39;/api/*&#39;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">      target</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;http://localhost:3001&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">      changeOrigin</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">      pathRewrite</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#98C379;">        &#39;/passager/xx&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;/mPassenger/ee&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#7F848E;font-style:italic;">// rewrite path</span></span>
<span class="line"><span style="color:#ABB2BF;">      }</span></span>
<span class="line"><span style="color:#ABB2BF;">    },</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">use</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">proxy</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">options</span><span style="color:#ABB2BF;">));</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>æºç ä¹Ÿæ²¡å‡ è¡Œï¼Œæœ‰å…´è¶£å¯ä»¥çœ‹ä¸‹ <a href="https://github.com/sunyongjian/koa2-proxy-middleware/blob/master/lib/index.js" target="_blank" rel="noreferrer">koa2-proxy-middleware</a></p><h2 id="å¼•å…¥react-helmet" tabindex="-1">å¼•å…¥react-helmet <a class="header-anchor" href="#å¼•å…¥react-helmet" aria-label="Permalink to &quot;å¼•å…¥react-helmet&quot;">â€‹</a></h2><p>åšæ›´å®Œæ•´çš„SEO</p><p>App ç»„ä»¶åµŒå…¥åˆ° <code>document.getElementById(&#39;root&#39;)</code> èŠ‚ç‚¹å½“ä¸­ï¼Œä¸€èˆ¬æ˜¯ä¸åŒ…å« head æ ‡ç­¾çš„ï¼Œä½†æ˜¯å•é¡µåº”ç”¨åœ¨åˆ‡æ¢è·¯ç”±æ—¶ï¼Œå¯èƒ½ä¹Ÿä¼šéœ€è¦åŠ¨æ€ä¿®æ”¹ head æ ‡ç­¾ä¿¡æ¯ï¼Œæ¯”å¦‚ title å†…å®¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šåœ¨å•é¡µé¢åº”ç”¨åˆ‡æ¢é¡µé¢ï¼Œä¸ä¼šç»è¿‡æœåŠ¡ç«¯æ¸²æŸ“ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶éœ€è¦æ›´æ”¹ document çš„ title å†…å®¹ã€‚</p><p>å¦‚æœç›´æ¥æ”¹å®¢æˆ·ç«¯çš„title,ç›´æ¥å°±å¯ä»¥ä½¿ç”¨<code>document.title</code>,ä½†æ˜¯æˆ‘ä»¬ç°åœ¨è¦æŠŠSEOåšå¥½ï¼Œç„¶åæˆ‘ä»¬è¦æ›´æ”¹æœåŠ¡ç«¯headé‡Œé¢çš„meta titleç­‰å†…å®¹,è¿™é‡Œæˆ‘ä»¬è¦ç”¨åˆ° <a href="https://github.com/nfl/react-helmet" target="_blank" rel="noreferrer">react-helmet</a>ã€‚</p><p>å…·ä½“ä»£ç éå¸¸ç®€å•</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// å®¢æˆ·ç«¯å®ç°æ–¹å¼</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> React</span><span style="color:#ABB2BF;">, {</span><span style="color:#E06C75;">Component</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">Fragment</span><span style="color:#ABB2BF;">} </span><span style="color:#C678DD;">from</span><span style="color:#98C379;"> &quot;react&quot;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> {</span><span style="color:#E06C75;">Helmet</span><span style="color:#ABB2BF;">} </span><span style="color:#C678DD;">from</span><span style="color:#98C379;"> &quot;react-helmet&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> Index</span><span style="color:#C678DD;"> extends</span><span style="color:#E5C07B;"> Component</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">  render</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;</span><span style="color:#E5C07B;">Fragment</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E5C07B;">Helmet</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">          &lt;</span><span style="color:#E06C75;">title</span><span style="color:#ABB2BF;">&gt;è¿™æ˜¯loginé¡µ&lt;/</span><span style="color:#E06C75;">title</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">          &lt;</span><span style="color:#E06C75;">meta</span><span style="color:#D19A66;font-style:italic;"> name</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;description&quot;</span><span style="color:#D19A66;font-style:italic;"> content</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;è¿™é‡Œæ˜¯ç¦¾å£å’Œreact-ssrçš„è°ƒç ”&quot;</span><span style="color:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;/</span><span style="color:#E5C07B;">Helmet</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;/</span><span style="color:#E5C07B;">Fragment</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">     )</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// æœåŠ¡ç«¯å®ç°</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> Koa</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &#39;koa&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> React</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &quot;react&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E06C75;"> Router</span><span style="color:#C678DD;"> from</span><span style="color:#98C379;"> &quot;koa-router&quot;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> {</span><span style="color:#E06C75;">renderToString</span><span style="color:#ABB2BF;">} </span><span style="color:#C678DD;">from</span><span style="color:#98C379;"> &#39;react-dom/server&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> {</span><span style="color:#E06C75;">StaticRouter</span><span style="color:#ABB2BF;">} </span><span style="color:#C678DD;">from</span><span style="color:#98C379;"> &#39;react-router-dom&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> {</span><span style="color:#E06C75;">Helmet</span><span style="color:#ABB2BF;">} </span><span style="color:#C678DD;">from</span><span style="color:#98C379;"> &#39;react-helmet&#39;</span><span style="color:#ABB2BF;">; </span><span style="color:#7F848E;font-style:italic;">// è¿™é‡Œå¼•å…¥</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// ....</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> app</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> Koa</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> route</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> Router</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">route</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">([</span><span style="color:#98C379;">&quot;/:route?&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> /</span><span style="color:#56B6C2;">\\/</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">[</span><span style="color:#E06C75;">\\w</span><span style="color:#D19A66;">|</span><span style="color:#E06C75;">\\d</span><span style="color:#D19A66;">]+</span><span style="color:#E06C75;">)</span><span style="color:#56B6C2;">\\/</span><span style="color:#E06C75;">.</span><span style="color:#D19A66;">*</span><span style="color:#E06C75;">/</span><span style="color:#ABB2BF;">], (</span><span style="color:#E06C75;font-style:italic;">ctx</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  // ....</span></span>
<span class="line"><span style="color:#C678DD;">  const</span><span style="color:#E5C07B;"> helmet</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> Helmet</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">renderStatic</span><span style="color:#ABB2BF;">(); </span><span style="color:#7F848E;font-style:italic;">// è¿™é‡Œè·å–ä¸‹å½“å‰çš„headä¿¡æ¯</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">  const</span><span style="color:#E5C07B;"> content</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> renderToString</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E5C07B;">StaticRouter</span><span style="color:#D19A66;font-style:italic;"> location</span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;">{</span><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">path</span><span style="color:#C678DD;">}</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;</span><span style="color:#E5C07B;">StyleContext.Provider</span><span style="color:#D19A66;font-style:italic;"> value</span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;">{</span><span style="color:#ABB2BF;">{</span><span style="color:#E06C75;">insertCss</span><span style="color:#ABB2BF;">}</span><span style="color:#C678DD;">}</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#C678DD;">        {</span><span style="color:#61AFEF;">renderRoutes</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">routes</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">routes</span><span style="color:#ABB2BF;">)</span><span style="color:#C678DD;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;/</span><span style="color:#E5C07B;">StyleContext.Provider</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E5C07B;">StaticRouter</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  )</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#E5C07B;">  ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">body</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> \`</span></span>
<span class="line"><span style="color:#98C379;">    &lt;!DOCTYPE html&gt;</span></span>
<span class="line"><span style="color:#98C379;">      &lt;html lang=&quot;zh-Hans-CN&quot;&gt;</span></span>
<span class="line"><span style="color:#98C379;">        &lt;head&gt;</span></span>
<span class="line"><span style="color:#98C379;">          &lt;meta charset=&quot;utf-8&quot;&gt;</span></span>
<span class="line"><span style="color:#C678DD;">          \${</span><span style="color:#E5C07B;">helmet</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">title</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">toString</span><span style="color:#ABB2BF;">()</span><span style="color:#C678DD;">}</span></span>
<span class="line"><span style="color:#C678DD;">          \${</span><span style="color:#E5C07B;">helmet</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">meta</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">toString</span><span style="color:#ABB2BF;">()</span><span style="color:#C678DD;">}</span></span>
<span class="line"><span style="color:#98C379;">          &lt;link rel=&quot;shortcut icon&quot; href=&quot;/favicon.ico&quot;&gt;</span></span>
<span class="line"><span style="color:#98C379;">          &lt;style&gt;</span><span style="color:#C678DD;">\${</span><span style="color:#ABB2BF;">[...</span><span style="color:#E06C75;">css</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">)</span><span style="color:#C678DD;">}</span><span style="color:#98C379;">&lt;/style&gt;</span></span>
<span class="line"><span style="color:#98C379;">        &lt;/head&gt;</span></span>
<span class="line"><span style="color:#98C379;">        &lt;body&gt;</span></span>
<span class="line"><span style="color:#98C379;">          &lt;div id=&quot;root&quot;&gt;</span><span style="color:#C678DD;">\${</span><span style="color:#E06C75;">content</span><span style="color:#C678DD;">}</span><span style="color:#98C379;">&lt;/div&gt;</span></span>
<span class="line"><span style="color:#98C379;">          &lt;script src=/index.js&gt;&lt;/script&gt;</span></span>
<span class="line"><span style="color:#98C379;">        &lt;/body&gt;</span></span>
<span class="line"><span style="color:#98C379;">    &lt;/html&gt;</span></span>
<span class="line"><span style="color:#98C379;">  \`</span></span>
<span class="line"><span style="color:#ABB2BF;">})</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// ...  ...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h2 id="è¯·æ±‚tokenå¤„ç†" tabindex="-1">è¯·æ±‚tokenå¤„ç† <a class="header-anchor" href="#è¯·æ±‚tokenå¤„ç†" aria-label="Permalink to &quot;è¯·æ±‚tokenå¤„ç†&quot;">â€‹</a></h2><p>å®¢æˆ·ç«¯ç™»å½•çš„æ—¶å€™ï¼ŒæŠŠç™»å½•çš„tokenï¼Œæ”¾åˆ°æµè§ˆå™¨çš„cookieä¸­å¹¶ä¸”å­˜åˆ°reduxä¸€ä»½ï¼Œcookieåœ¨æœåŠ¡ç«¯å¯ä»¥é€šè¿‡è¯·æ±‚çš„é¡µé¢ç›´æ¥è·å–åˆ°ï¼›æ‰€ä»¥å½“ç”¨æˆ·åˆ·æ–°é¡µé¢çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡é¡µé¢è¯·æ±‚è·å–åˆ°token,ç„¶åå‘reduxé‡Œé¢å­˜æ”¾ä¸€ä»½ï¼Œè¿™æ ·å®¢æˆ·ç«¯æƒ³è¦è·å–tokenå°±å¯ä»¥ç›´æ¥åœ¨reduxé‡Œé¢æ‹¿äº†ï¼ŒloadDateå‡½æ•°å¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°ä¼ è¿›è·å–ã€‚</p><p><img src="https://ae01.alicdn.com/kf/Hab97bac5556440f787abf0ecde0a0f349.jpg" alt=""></p><h2 id="_404é¡µé¢" tabindex="-1">404é¡µé¢ <a class="header-anchor" href="#_404é¡µé¢" aria-label="Permalink to &quot;404é¡µé¢&quot;">â€‹</a></h2><p>ç”¨<code>react-router-config</code>çš„<code>matchRoutes</code>æ–¹æ³•ï¼Œå½“æ•è·ä¸ºç©ºæ•°ç»„çš„æ—¶å€™ï¼Œè¯´æ˜æ²¡æœ‰å½“å‰è·¯ç”±ï¼Œè·³è½¬åˆ°404 é¡µé¢ï¼Œè¿™é‡Œé¢æœ‰ä¸€ä¸ªæ³¨æ„çš„ç‚¹æ˜¯ï¼Œå¦‚è¯´æœ‰äºŒçº§æˆ–äºŒçº§ä»¥ä¸Šçš„è·¯ç”±ï¼Œè¿™ä¸ªæ–¹æ³•èƒ½æ•è·ç¬¬ä¸€ä¸ªè·¯ç”±çš„æ–¹æ³•ï¼Œæ‰€ä»¥è¦åˆ¤æ–­å½“å‰è·å–åˆ°çš„æ˜¯ä¸æ˜¯ä¸€çº§è·¯ç”±ï¼Œè€Œä¸”å½“å‰æ•°æ®è¿˜ä¸èƒ½ä¸ºç©ºã€‚</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// server/index.js  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// åˆ¤æ–­404</span></span>
<span class="line"><span style="color:#C678DD;">let</span><span style="color:#E06C75;"> hasRoute</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> matchedRoutes</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">length</span><span style="color:#56B6C2;"> ===</span><span style="color:#D19A66;"> 1</span><span style="color:#56B6C2;"> &amp;&amp;</span><span style="color:#56B6C2;"> !!</span><span style="color:#E06C75;">matchedRoutes</span><span style="color:#ABB2BF;">[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">].</span><span style="color:#E5C07B;">route</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">routes</span></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">hasRoute</span><span style="color:#56B6C2;"> ||</span><span style="color:#56B6C2;"> !</span><span style="color:#E5C07B;">matchedRoutes</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">length</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;">  ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">response</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">redirect</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/404&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">  return</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// æ·»åŠ  â€˜/â€™ é‡å®šå‘æ˜¯ä¸€æ ·çš„å¥—è·¯</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="å®‰å…¨é—®é¢˜" tabindex="-1">å®‰å…¨é—®é¢˜ <a class="header-anchor" href="#å®‰å…¨é—®é¢˜" aria-label="Permalink to &quot;å®‰å…¨é—®é¢˜&quot;">â€‹</a></h2><p>å®‰å…¨é—®é¢˜éå¸¸å…³é”®ï¼Œå°¤å…¶æ˜¯æ¶‰åŠåˆ°æœåŠ¡ç«¯æ¸²æŸ“ï¼Œå¼€å‘è€…è¦æ ¼å¤–å°å¿ƒã€‚è¿™é‡Œæå‡ºä¸€ä¸ªç‚¹ï¼šæˆ‘ä»¬å‰é¢æåˆ°äº†æ³¨æ°´å’Œè„±æ°´è¿‡ç¨‹ï¼Œå…¶ä¸­çš„ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">script</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  window.context = </span><span style="color:#C678DD;">{</span></span>
<span class="line"><span style="color:#E06C75;">    initialState</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">$</span><span style="color:#ABB2BF;">{JSON.stringify(store.getState())}</span></span>
<span class="line"><span style="color:#C678DD;">   }</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">script</span><span style="color:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>éå¸¸å®¹æ˜“é­å— XSS æ”»å‡»ï¼ŒJSON.stringify å¯èƒ½ä¼šé€ æˆ script æ³¨å…¥,ä½¿ç”¨ serialize-javascript åº“è¿›è¡Œå¤„ç†ï¼Œè¿™ä¹Ÿæ˜¯åŒæ„åº”ç”¨ä¸­æœ€å®¹æ˜“è¢«å¿½è§†çš„ç»†èŠ‚ã€‚</p><p><strong>å¦ä¸€ä¸ªè§„é¿è¿™ç§ XSS é£é™©çš„åšæ³•æ˜¯</strong>ï¼šå°†æ•°æ®ä¼ é€’ä¸ªé¡µé¢ä¸­ä¸€ä¸ªéšè—çš„ textarea çš„ value ä¸­ï¼Œtextarea çš„ value è‡ªç„¶å°±ä¸æ€• XSS é£é™©äº†ã€‚</p><h2 id="ä¼˜åŒ–" tabindex="-1">ä¼˜åŒ– <a class="header-anchor" href="#ä¼˜åŒ–" aria-label="Permalink to &quot;ä¼˜åŒ–&quot;">â€‹</a></h2><ol><li>å®¢æˆ·ç«¯jsæ‹†åŒ…ï¼Œå‹ç¼©ä»£ç </li><li>å®¢æˆ·ç«¯æ‰“åŒ…çš„jså¸¦æœ‰hashåç¼€</li><li>ä½¿ç”¨copy-webpack-pluginï¼Œç›´æ¥æŠŠéœ€è¦çš„æ–‡ä»¶ï¼Œæ‰“åŒ…åˆ°å¯¹åº”çš„æ–‡ä»¶å¤¹ã€‚</li><li>ä¸­é—´ä»¶è½¬å‘ä»£ç† è·¨åŸŸç­‰</li><li>é™æ€èµ„æºä½¿ç”¨cdn</li><li>æœåŠ¡ç«¯ä½¿ç”¨ç¼“å­˜</li><li>å¯¹æœåŠ¡ç«¯å‹åŠ›è¿‡å¤§çš„æ—¶å€™ï¼Œåˆ‡æ¢åˆ°å®¢æˆ·ç«¯æ¸²æŸ“</li><li>nodeJs/ReactJsçš„ç‰ˆæœ¬å‡çº§</li></ol><h2 id="é‡åˆ°çš„é—®é¢˜æ±‡æ€»" tabindex="-1">é‡åˆ°çš„é—®é¢˜æ±‡æ€» <a class="header-anchor" href="#é‡åˆ°çš„é—®é¢˜æ±‡æ€»" aria-label="Permalink to &quot;é‡åˆ°çš„é—®é¢˜æ±‡æ€»&quot;">â€‹</a></h2><ol><li><p>äºŒçº§èœå•çš„æ—¶å€™è·å–åˆ°é™æ€èµ„æºçš„è·¯å¾„ï¼Œå¸¦ç€ç¬¬ä¸€çº§èœå•çš„è·¯å¾„</p></li><li><p>æœåŠ¡ç«¯å¯¼å…¥css çš„æ—¶å€™ï¼Œcssæ˜¯æœ‰åšhash å¤„ç†ä¸èƒ½æ­£ç¡®çš„åŠ è½½css (cssmodules)</p></li><li><p>æœåŠ¡ç«¯å¯¼å…¥cssæ—¶å‘ç”Ÿåœ¨componentWillMountå‘¨æœŸå‡½æ•°ï¼Œä¸èƒ½åœ¨componentDidMount,æ­¤æ—¶å·²ç»åˆ°å®¢æˆ·ç«¯äº†ã€‚</p></li><li><p>koaçš„è·¯ç”±ä¸åƒexpressé‚£æ ·ä¸èƒ½ç›´æ¥ä½¿ç”¨ ***** ï¼Œ ï¼ˆå¯èƒ½å¯ä»¥ï¼Œåœ¨æˆ‘è¿™æŠ¥é”™ï¼‰</p></li><li><p>ä¸­é—´ä»¶çš„é¡ºåºã€å’Œå¼‚æ­¥æ—¶ ctx.body=&#39;&#39; çš„é—®é¢˜ï¼ˆå¦‚æœæœ‰å¼‚æ­¥æ“ä½œä¸­é—´ä»¶å°±å¿…é¡»å†™æˆ async å‡½æ•°ï¼‰</p></li><li><p>react-helmet ä½¿ç”¨æ—¶ï¼ŒæœåŠ¡ç«¯æ²¡æœ‰æ˜¾ç¤ºè®¾ç½®çš„titleç­‰ä¿¡æ¯ ï¼ˆåœ¨æœ€å¤–å±‚å¯¼å…¥ï¼‰</p></li><li><p>æ³¨æ°´çš„æ—¶å€™ï¼Œæ³¨æ„reduxå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„åŒºåˆ«å’Œè”ç³»</p></li><li><p>æ³¨æ°´å¼‚æ­¥åŠ è½½çš„é—®é¢˜ promise.all()</p></li><li><p>å®¢æˆ·ç«¯è·¯ç”±ä½¿ç”¨çš„history,è·³è½¬ä¸è®¿é—®koaçš„è·¯ç”±</p></li><li><p>ssr éƒ¨ç½²ä»£ç ä½“ç§¯ç‰¹åˆ«å¤§ ,æ·»åŠ å¹¶å‘ï¼Œå…¬å…±å•ç‹¬æ‹†å‡ºã€ä½¿ç”¨cdn</p></li><li><p>pm2ç¯å¢ƒå˜é‡çš„é—®é¢˜ï¼Œ</p></li><li><p>å¼€å¯cssModulesåæŠŠantdçš„æ ·å¼ä¹Ÿç¼–è¯‘äº†</p></li><li><p>æ·»åŠ ä¸€ä¸ªå¸¸é‡æ•°ç»„ï¼Œç”¨æ¥è¡¨ç¤ºé‚£äº›å¿…é¡»ç”¨æ¥æœåŠ¡ç«¯æ¸²æŸ“(æé«˜åŠ è½½é€Ÿåº¦)ï¼Œä¸èƒ½å¤ªå¤šï¼Œå½±å“æ€§èƒ½ã€è®°å¾—å»é‡ã€‘</p></li><li><p>ä»åˆ«çš„é¡µé¢è·³è½¬è¿‡æ¥çš„ï¼Œä¸ºä»€ä¹ˆæ‰“å¼€ç½‘é¡µæºä»£ç æœ‰æ¸²æŸ“å¥½çš„html,ä¸åº”è¯¥åªæœ‰é¦–å±æ¸²æŸ“å—ï¼Ÿã€æ‰“å¼€æ§åˆ¶å°ç›¸å½“äºé‡æ–°æ¸²æŸ“äº†ã€‘</p></li><li><p><a href="https://github.com/wkvictory/react-ssr/blob/master/src/pages/home/model.js#L27" target="_blank" rel="noreferrer">æœåŠ¡ç«¯è·å–äº†æ•°æ®ï¼Œå®¢æˆ·ç«¯æ€ä¹ˆåˆ¤æ–­å·²ç»è·å–äº†ï¼Œä¸å†è°ƒå–æ¥å£</a></p></li><li><p>æœåŠ¡ç«¯æœ‰äº†csså®¢æˆ·ç«¯è¿˜éœ€è¦å—ï¼Ÿ</p><p><strong>ç­”æ¡ˆæ˜¯éœ€è¦çš„ã€‚</strong></p><p>æœåŠ¡ç«¯çš„csså…¶å®å°±æ˜¯å®¢æˆ·ç«¯ç»™çš„ï¼SSRçš„æ¸²æŸ“åªæ˜¯é’ˆå¯¹é¡µé¢çš„é¦–å±ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ· ç¬¬ä¸€æ¬¡æ‰“å¼€çš„é¡µé¢ï¼Œå½“ä»é¦–å±è·³è½¬åˆ°åˆ«çš„é¡µé¢çš„æ—¶å€™ï¼Œè¿™æ—¶å€™è¿˜æ˜¯éœ€è¦å®¢æˆ·ç«¯æ¥æ¸²æŸ“çš„ï¼Œheadçš„cssä¹Ÿæ˜¯é€šè¿‡jsçš„é«˜é˜¶å‡½æ•°ï¼Œä¼ è¿›å»çš„ï¼Œæ‰€ä»¥å½“å®¢æˆ·ç«¯æ²¡æœ‰äº†cssï¼ŒæœåŠ¡ç«¯ä¸€å®šæ˜¯æ²¡æœ‰cssçš„ã€‚åœ¨reactçš„é¡¹ç›®ä¸­æ˜¯æ²¡æœ‰çœŸæ­£çš„cssçš„ï¼Œæ‰€è°“çš„cssä¹Ÿæ˜¯é€šè¿‡jsæ¥å®ç°åŠ¨æ€å¼•å…¥ï¼Œæ‰€ä»¥cssä¹Ÿæ˜¯js,åŒ…æ‹¬å›¾ç‰‡ã€‚</p></li><li><p>ssræ€ä¹ˆè¿›è¡Œå‚æ•°çš„ä¼ è¾“å’Œè·å–</p><ul><li><strong>ç›´æ¥ä½¿ç”¨é—®å·ä¼ å‚</strong></li></ul><p>å®¢æˆ·ç«¯pathï¼š /a/b?id=1008611 ç„¶åé€šè¿‡æ­£åˆ™æˆ–è€…ä½¿ç”¨qsè·å–åˆ°idçš„å€¼</p><ul><li><strong>åœ°å€æ ä¼ å‚</strong></li></ul></li></ol><p><strong>æ–¹æ³•ä¸€</strong></p><pre><code>æƒ³è¦ä¼ å‚å®¢æˆ·ç«¯è·¯ç”±åœ¨åå°è®¾ç½®ä¸‹ï¼Œä½¿å®ƒèƒ½ç›´æ¥è·å–åˆ°params
ä¾‹å¦‚ï¼šroute.get(&#39;detail/id:?&#39;()=&gt;{}))
æœ€å¥½æ˜¯æŠŠå®¢æˆ·ç«¯æ‰€æœ‰è¦ä¼ å‚urléƒ½æ·»åŠ ä¸€æ ·çš„å‰ç¼€
é¡µé¢A menu/homeDetail/1212
é¡µé¢B menu/aboutDetail/3434

route.get(&#39;menu/:pageInfo?/:id?&#39;()=&gt;{}))

 **æ–¹æ³•äºŒ**
 ä¹Ÿæ˜¯æˆ‘å†ç”¨çš„æ–¹æ³•ï¼Œè·å–åˆ°å½“å‰çš„è·¯ç”±pathå’Œè¯·æ±‚çš„url,é€šè¿‡æ­£åˆ™è·å–åˆ°å½“å‰çš„idä¹Ÿå¯ä»¥ç›´æ¥ç”¨\`path-to-regexp\`
</code></pre><blockquote><p>ä¸Šé¢çš„é—®é¢˜ï¼Œå‡å·²è§£å†³ï¼Œå¯èƒ½æ–‡ç« ä»‹ç»çš„ä¸å…·ä½“ï¼Œå…·ä½“ä»¥æºç ä¸ºå‡†ã€‚</p></blockquote><p><code>å–œæ¬¢çš„markğŸ‘</code></p><h2 id="å‚è€ƒæ–‡æ¡£" tabindex="-1">å‚è€ƒæ–‡æ¡£ <a class="header-anchor" href="#å‚è€ƒæ–‡æ¡£" aria-label="Permalink to &quot;å‚è€ƒæ–‡æ¡£&quot;">â€‹</a></h2><p><a href="http://blog.poetries.top/2018/11/18/react-ssr/?utm_source=tuicool&amp;utm_medium=referral" target="_blank" rel="noreferrer">ä»é›¶åˆ°ä¸€æ­å»ºReact SSRå·¥ç¨‹æ¶æ„</a></p><p><a href="https://zhuanlan.zhihu.com/p/66672794" target="_blank" rel="noreferrer">çŸ¥ä¹ rendertron</a></p><p><a href="https://github.com/wkvictory/react-ssr" target="_blank" rel="noreferrer">æœ¬æ–‡çš„githubåœ°å€</a></p>`,148),o=[e];function r(t,c,B,y,i,b){return a(),n("div",null,o)}const F=s(p,[["render",r]]);export{u as __pageData,F as default};
